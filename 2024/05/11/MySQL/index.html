<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL | MYC</title><meta name="author" content="MYC"><meta name="copyright" content="MYC"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="MySQL基础连接: cmd  输入  mysql -u root -p   在输入密码123456 DDL,DML,DQL,DCL SQL分类 DDL:全称:Data Definition Language  数据定义语言,用来定义数据库对象(数据库,表,字段) DDL-基本操作查询 : 查询所有数据库 :  ​        SHOW DATABASES ;  查询当前数据库 :  ​">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL">
<meta property="og:url" content="http://example.com/2024/05/11/MySQL/index.html">
<meta property="og:site_name" content="MYC">
<meta property="og:description" content="MySQL基础连接: cmd  输入  mysql -u root -p   在输入密码123456 DDL,DML,DQL,DCL SQL分类 DDL:全称:Data Definition Language  数据定义语言,用来定义数据库对象(数据库,表,字段) DDL-基本操作查询 : 查询所有数据库 :  ​        SHOW DATABASES ;  查询当前数据库 :  ​">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2024-05-11T00:42:00.000Z">
<meta property="article:modified_time" content="2024-05-11T00:45:32.078Z">
<meta property="article:author" content="MYC">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/05/11/MySQL/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: MYC","link":"链接: ","source":"来源: MYC","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-11 08:45:32'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/transpancy.css"><link rel="stylesheet" href="/css/custom.css"><style type="text/css"> #universe {  display: block; position: fixed; margin: 0; padding: 0; border: 0; outline: 0; left: 0; top: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; } </style><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="MYC" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><script async="async">(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })
  setTimeout(function(){preloader.endLoading();}, 5000);
  document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/xiaoxin.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="MYC"><span class="site-name">MYC</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-11T00:42:00.000Z" title="发表于 2024-05-11 08:42:00">2024-05-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-05-11T00:45:32.078Z" title="更新于 2024-05-11 08:45:32">2024-05-11</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">21.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>72分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/05/11/MySQL/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2024/05/11/MySQL/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MySQL基础"><a href="#MySQL基础" class="headerlink" title="MySQL基础"></a><strong><em>MySQL基础</em></strong></h1><p>连接: cmd  输入  mysql -u root -p   在输入密码123456</p>
<h2 id="DDL-DML-DQL-DCL"><a href="#DDL-DML-DQL-DCL" class="headerlink" title="DDL,DML,DQL,DCL"></a>DDL,DML,DQL,DCL</h2><hr>
<h2 id="SQL分类"><a href="#SQL分类" class="headerlink" title="SQL分类"></a>SQL分类</h2><hr>
<h3 id="DDL"><a href="#DDL" class="headerlink" title="DDL:"></a>DDL:</h3><p>全称:Data Definition Language  数据定义语言,用来定义数据库对象(数据库,表,字段)</p>
<h4 id="DDL-基本操作"><a href="#DDL-基本操作" class="headerlink" title="DDL-基本操作"></a>DDL-基本操作</h4><h5 id="查询"><a href="#查询" class="headerlink" title="查询 :"></a>查询 :</h5><ul>
<li>查询所有数据库 :</li>
</ul>
<p>​        SHOW DATABASES ;</p>
<ul>
<li>查询当前数据库 :</li>
</ul>
<p>​        SELECT DATABASE() ;</p>
<h5 id="创建"><a href="#创建" class="headerlink" title="创建 :"></a>创建 :</h5><p>CREATE DATABASE[IF NOT EXISTS] 数据库名 [DEFAULT CHARSET 字符集] [COLLATE 排序规则] ;</p>
<h5 id="删除"><a href="#删除" class="headerlink" title="删除 :"></a>删除 :</h5><p>DROP DATABASE[IF EXISTS]数据库名 ;</p>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用 :"></a>使用 :</h5><p>USE 数据库名 ;</p>
<h4 id="DDL-表操作"><a href="#DDL-表操作" class="headerlink" title="DDL-表操作"></a>DDL-表操作</h4><h5 id="查询-1"><a href="#查询-1" class="headerlink" title="查询 :"></a>查询 :</h5><ul>
<li>查询当前数据库所有表:</li>
</ul>
<p>​        SHOW TABLES;</p>
<ul>
<li>查询表结构:</li>
</ul>
<p>​        DESC 表名;</p>
<ul>
<li>查询指定表的建表语句:</li>
</ul>
<p>​        SHOW CREATE TABLE 表名;</p>
<h5 id="创建-1"><a href="#创建-1" class="headerlink" title="创建:"></a>创建:</h5><p>​        CREATE TABLE 表名(</p>
<p>​        字段1  字段1类型[COMMENT 字段1注释],</p>
<p>​        字段2 字段2类型[COMMENT 字段2注释],</p>
<p>​        字段3 字段3类型[COMMENT 字段3注释],</p>
<p>​        ……</p>
<p>​        字段n 字段n类型[COMMENT 字段n注释]</p>
<p>​        )[COMMENT 表注释];</p>
<h5 id="修改"><a href="#修改" class="headerlink" title="修改:"></a>修改:</h5><ul>
<li>添加字段:</li>
</ul>
<p>ALTER TABLE 表名 ADD 字段名 类型(长度)[COMMENT 注释] [约束];</p>
<ul>
<li>修改字段:</li>
</ul>
<p>​        1&gt;    修改数据类型</p>
<p>​                ALTER TABLE 表名 MODIFY 字段名 新数据类型(长度);</p>
<p>​        2&gt;    修改字段名和字段类型</p>
<p>​                ALTER TABLE 表名 CHANGE 旧字段名 新字段名 类型(长度) [COMMENT 注释] [约束];</p>
<ul>
<li><p>删除字段</p>
<p>​        ALTER TABLE 表名 DROP 字段名;</p>
</li>
<li><p>修改表名</p>
<p>​        ALTER TABLE 表名 RENAME TO 新表名;</p>
</li>
</ul>
<h5 id="删除-1"><a href="#删除-1" class="headerlink" title="删除:"></a>删除:</h5><ul>
<li><p>删除表:</p>
<p>​        DROP TABLE[IF EXISTS] 表名;</p>
</li>
<li><p>删除指定表,并重新创建该表:</p>
<p>​        TRUNCATE TABLE 表名;</p>
</li>
</ul>
<h5 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型:"></a>数据类型:</h5><ul>
<li>数值类型:    </li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">大小</th>
<th style="text-align:center">有符号(SIGNED)范围</th>
<th style="text-align:center">无符号(UNSIGNED)范围</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TINYINT</td>
<td style="text-align:center">1 byte</td>
<td style="text-align:center">(-128，127)</td>
<td style="text-align:center">(0，255)</td>
<td style="text-align:center">小整数值</td>
</tr>
<tr>
<td style="text-align:center">SMALLINT</td>
<td style="text-align:center">2 bytes</td>
<td style="text-align:center">(-32768，32767)</td>
<td style="text-align:center">(0，65535)</td>
<td style="text-align:center">大整数值</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMINT</td>
<td style="text-align:center">3 bytes</td>
<td style="text-align:center">(-8388608，8388607)</td>
<td style="text-align:center">(0，16777215)</td>
<td style="text-align:center">大整数值</td>
</tr>
<tr>
<td style="text-align:center">INT或INTEGER</td>
<td style="text-align:center">4 bytes</td>
<td style="text-align:center">(-2147483648，2147483647)</td>
<td style="text-align:center">(0，4294967295)</td>
<td style="text-align:center">大整数值</td>
</tr>
<tr>
<td style="text-align:center">BIGINT</td>
<td style="text-align:center">8 bytes</td>
<td style="text-align:center">(-2~63，2~63-1)</td>
<td style="text-align:center">(0，2~64-1)</td>
<td style="text-align:center">极大整数值</td>
</tr>
<tr>
<td style="text-align:center">FLOAT</td>
<td style="text-align:center">4 bytes</td>
<td style="text-align:center">(-3.402823466 E+38，3.402823466351 E+38)</td>
<td style="text-align:center">0 和 (1.175494351 E-38，3.402823466 E+38)</td>
<td style="text-align:center">单精度浮点数值</td>
</tr>
<tr>
<td style="text-align:center">DOUBLE</td>
<td style="text-align:center">8 bytes</td>
<td style="text-align:center">(-1.7976931348623157 E+308，1.7976931348623157 E+308)</td>
<td style="text-align:center">0 和 (2.2250738585072014 E-308，1.7976931348623157 E+308)</td>
<td style="text-align:center">双精度浮点数值</td>
</tr>
<tr>
<td style="text-align:center">DECIMAL</td>
<td style="text-align:center"></td>
<td style="text-align:center">依赖于M(精度)和D(标度)的值</td>
<td style="text-align:center">依赖于M(精度)和D(标度)的值</td>
<td style="text-align:center">小数值(精确定点数)</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>123.45 精度就是5,标度就是2</p>
</li>
<li><p>字符串类型:</p>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">大小</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CHAR</td>
<td style="text-align:center">0-255 bytes</td>
<td style="text-align:center">定长字符串</td>
</tr>
<tr>
<td style="text-align:center">VARCHAR</td>
<td style="text-align:center">0-65535 bytes</td>
<td style="text-align:center">变长字符串</td>
</tr>
<tr>
<td style="text-align:center">TINYBLOB</td>
<td style="text-align:center">0-255 bytes</td>
<td style="text-align:center">不超过255个字符的二进制数据</td>
</tr>
<tr>
<td style="text-align:center">TINYTEXT</td>
<td style="text-align:center">0-255 bytes</td>
<td style="text-align:center">短文本字符串</td>
</tr>
<tr>
<td style="text-align:center">BLOB</td>
<td style="text-align:center">0-65535 bytes</td>
<td style="text-align:center">二进制形式的长文本数据</td>
</tr>
<tr>
<td style="text-align:center">TEXT</td>
<td style="text-align:center">0-65535 bytes</td>
<td style="text-align:center">长文本数据</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMBLOB</td>
<td style="text-align:center">0-16777215 bytes</td>
<td style="text-align:center">二进制形式的中等长度文本数据</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMTEXT</td>
<td style="text-align:center">0-16777215 bytes</td>
<td style="text-align:center">中等长度文本数据</td>
</tr>
<tr>
<td style="text-align:center">LONGBLOB</td>
<td style="text-align:center">0-4294967295 bytes</td>
<td style="text-align:center">二进制形式的极大文本数据</td>
</tr>
<tr>
<td style="text-align:center">LONGTEXT</td>
<td style="text-align:center">0-4294967295 bytes</td>
<td style="text-align:center">极大文本数据</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>日期时间类型:</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">大小</th>
<th style="text-align:center">范围</th>
<th style="text-align:center">格式</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DATE</td>
<td style="text-align:center">3</td>
<td style="text-align:center">1000-01-01 至 9999-12-31</td>
<td style="text-align:center">YYYY-MM-DD</td>
<td style="text-align:center">日期值</td>
</tr>
<tr>
<td style="text-align:center">TIME</td>
<td style="text-align:center">3</td>
<td style="text-align:center">-838:59:59 至 838:59:59</td>
<td style="text-align:center">HH:MM: SS</td>
<td style="text-align:center">时间值或持续时间</td>
</tr>
<tr>
<td style="text-align:center">YEAR</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1901 至 2155</td>
<td style="text-align:center">YYYY</td>
<td style="text-align:center">年份值</td>
</tr>
<tr>
<td style="text-align:center">DATETIME</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1000-01-01 00:00:00 至 9999-12-31 23:59:59</td>
<td style="text-align:center">YYYY-MM-DD HH:MM:SS</td>
<td style="text-align:center">混合日期和时间值</td>
</tr>
<tr>
<td style="text-align:center">TIMESTAMP</td>
<td style="text-align:center">4</td>
<td style="text-align:center">1970-01-01 00:00:01 至 2038-01-19 03:14:07</td>
<td style="text-align:center">YYYY-MM-DD HH:MM:SS</td>
<td style="text-align:center">混合日期和时间值，时间戳</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="DML"><a href="#DML" class="headerlink" title="DML:"></a>DML:</h3><p>全称:Data Manipulation Language 数据操作语言,用来对数据库表中的数据进行增删改</p>
<h4 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据:"></a>添加数据:</h4><ul>
<li><p>给指定的字段添加数据</p>
<p>INSERT INTO 表名 (字段名1,字段名2,…) VALUES(值1,值2,…) ;</p>
</li>
<li><p>给全部的字段添加数据</p>
<p>INSERT INTO 表名 VALUES(值1,值2,…) ;</p>
</li>
<li><p>批量添加数据</p>
<p>INSERT INTO 表名(字段名1,字段名2,…) VALUES(值1,值2,…),(值1,值2,…),(值1,值2,…) ;</p>
<p>INSERT INTO 表名 VALUES (值1,值2,…),(值1,值2,…),(值1,值2,…) ;</p>
</li>
</ul>
<blockquote>
<p>注意!</p>
<ul>
<li>插入数据时,指定的字段顺序需要与值的顺序是一一对应的.</li>
<li>字符串和日期型数据应包含在引号中.</li>
<li>插入的数据大小,应该在字段的规定范围内.</li>
</ul>
</blockquote>
<h4 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据:"></a>修改数据:</h4><p>​        UPDATE 表名 SET 字段名1 = 值1,字段名2 = 值2 , …[WHERE 条件] ;</p>
<h4 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据:"></a>删除数据:</h4><p>​        DELETE FROM 表名 [WHERE 条件] ;</p>
<blockquote>
<p>注意!</p>
<ul>
<li><p>DELETE 语句的条件可以有,也可以没有,如果没有条件,则会删除整张表的所有内容.</p>
</li>
<li><p>DELETE 语句不能删除某一个字段的值(可以使用UPDATE).</p>
</li>
</ul>
</blockquote>
<hr>
<h3 id="DQL"><a href="#DQL" class="headerlink" title="DQL:"></a>DQL:</h3><p>全称:Data Query Language 数据库查询语言,用来查询数据库中表的记录</p>
<h4 id="查询-2"><a href="#查询-2" class="headerlink" title="查询"></a>查询</h4><h5 id="基本查询"><a href="#基本查询" class="headerlink" title="基本查询"></a>基本查询</h5><ul>
<li><p>查询多个字段</p>
<p>SELECT 字段1,字段2,字段3…FROM 表名 ;</p>
<p>SELECT * FROM 表名 ;</p>
</li>
<li><p>设置别名</p>
<p>SELECT 字段1 [AS 别名1],字段2 [AS 别名2] … FROM 表名 ;</p>
</li>
<li><p>去除重复记录</p>
<p>SELECT DISTINCT 字段列表 FROM 表名 </p>
</li>
</ul>
<h5 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h5><ul>
<li><p>语法</p>
<p>SELECT 字段列表 FROM 表名 WHERE 条件列表 ;</p>
</li>
<li><p>条件</p>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">比较运算符</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:center">大于</td>
</tr>
<tr>
<td style="text-align:center">&gt;=</td>
<td style="text-align:center">大于等于</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:center">小于</td>
</tr>
<tr>
<td style="text-align:center">&lt;=</td>
<td style="text-align:center">小于等于</td>
</tr>
<tr>
<td style="text-align:center">=</td>
<td style="text-align:center">等于</td>
</tr>
<tr>
<td style="text-align:center">&lt;&gt; 或 !=</td>
<td style="text-align:center">不等于</td>
</tr>
<tr>
<td style="text-align:center">BETWEEN … AND …</td>
<td style="text-align:center">在某个范围之内(含最小,最大值)</td>
</tr>
<tr>
<td style="text-align:center">IN(…)</td>
<td style="text-align:center">在in之后的列表中的值,多选一</td>
</tr>
<tr>
<td style="text-align:center">LIKE 占位符</td>
<td style="text-align:center">模糊匹配(_匹配单个字符,%匹配任意个字符)</td>
</tr>
<tr>
<td style="text-align:center">IS NULL</td>
<td style="text-align:center">是NULL</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">逻辑运算符</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AND 或 &amp;&amp;</td>
<td style="text-align:center">并且(多个条件同时成立)</td>
</tr>
<tr>
<td style="text-align:center">OR 或 \</td>
<td style="text-align:center">\</td>
<td></td>
<td>或者(多个条件任意一个成立)</td>
</tr>
<tr>
<td style="text-align:center">NOT 或 !</td>
<td style="text-align:center">非,不是</td>
</tr>
</tbody>
</table>
</div>
<h5 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h5><ul>
<li><p>语法</p>
<p>SELECT 字段列表 FROM 表名 [WHERE 条件] GROUP BY 分组字段名 [HAVING 分组后过滤条件] ;</p>
</li>
</ul>
<ul>
<li><p>WHERE 与 HAVING区别</p>
<p>执行时机不同 : WHERE是分组之前进行过滤,不满足WHERE条件,不参与分组 ; 而HAVING是分组之后对结果进行过滤 .</p>
<p>判断条件不同 : WHERE不能对聚合函数进行判断,而HAVING可以 .</p>
</li>
</ul>
<blockquote>
<p>注意 !</p>
<ul>
<li>执行顺序: where &gt; 聚合函数 &gt; having .</li>
<li>分组之后,查询的字段一般为聚合函数和分组字段,查询其他字段无任何意义 .</li>
</ul>
</blockquote>
<h5 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h5><ul>
<li><p>语法</p>
<p>SELECT 字段列表 FROM 表名 ORDER BY 字段1 排序方式1,字段2 排序方式2 ;</p>
</li>
</ul>
<ul>
<li><p>排序方式</p>
<p>ASC : 升序 (默认值)</p>
<p>DESC: 降序</p>
</li>
</ul>
<blockquote>
<p>注意 !</p>
<ul>
<li>如果是多字段排序,当第一个字段值相同时,才会根据第二个字段进行排序 .</li>
</ul>
</blockquote>
<h5 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h5><ul>
<li><p>语法</p>
<p>SELECT 字段列表 FROM 表名 LIMIT 起始索引,查询记录数 ;</p>
</li>
</ul>
<blockquote>
<p>注意 !</p>
<ul>
<li>起始索引从0开始,其实索引 = (查询页码 - 1) * 每页显示记录数 .</li>
<li>分页查询是数据库的方言,不同的数据库有不同的实现,MySQL中时LIMIT .</li>
<li>如果你查询的是第一页数据,起始索引可以省略,直接简写为 linit 10 .</li>
</ul>
</blockquote>
<h5 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h5><ul>
<li><p>介绍:</p>
<p>将一列数据作为一个整体,进行纵向计算.</p>
</li>
</ul>
<ul>
<li>常见聚合函数</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">count</td>
<td style="text-align:center">统计数量</td>
</tr>
<tr>
<td style="text-align:center">max</td>
<td style="text-align:center">最大值</td>
</tr>
<tr>
<td style="text-align:center">min</td>
<td style="text-align:center">最小值</td>
</tr>
<tr>
<td style="text-align:center">avg</td>
<td style="text-align:center">平均值</td>
</tr>
<tr>
<td style="text-align:center">sum</td>
<td style="text-align:center">求和</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>语法</p>
<p>SELECE 聚合函数 (字段列表) FROM 表名 ;</p>
</li>
</ul>
<h5 id="编写顺序"><a href="#编写顺序" class="headerlink" title="编写顺序"></a>编写顺序</h5><p>​        SELECT </p>
<p>​                        字段列表</p>
<p>​        FROM</p>
<p>​                        表名列表</p>
<p>​        WHERE</p>
<p>​                        条件列表</p>
<p>​        GROUP BY</p>
<p>​                        分组字段列表</p>
<p>​        HAVING</p>
<p>​                        分组后条件列表</p>
<p>​        ORDER BY</p>
<p>​                        排序字段列表</p>
<p>​        LIMIT</p>
<p>​                        分页参数</p>
<h5 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h5><p>​        FROM</p>
<p>​                        表名列表</p>
<p>​        WHERE</p>
<p>​                        条件列表</p>
<p>​        GROUP BY</p>
<p>​                        分组字段列表</p>
<p>​        SELECT </p>
<p>​                        字段列表</p>
<p>​        ORDER BY</p>
<p>​                        排序字段列表</p>
<p>​        LIMIT</p>
<p>​                        分页参数</p>
<p>​        </p>
<hr>
<h3 id="DCL"><a href="#DCL" class="headerlink" title="DCL:"></a>DCL:</h3><p>全称:Data Control Language 数据库控制语言,用来创建数据库用户,控制数据库的访问权限</p>
<h4 id="管理用户"><a href="#管理用户" class="headerlink" title="管理用户"></a>管理用户</h4><h5 id="查询用户"><a href="#查询用户" class="headerlink" title="查询用户"></a>查询用户</h5><p>​        USE mysql ;</p>
<p>​        SELECT * FROM user ;</p>
<h5 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h5><p>​        CREATE USER ‘用户名’ @ ‘主机名’  IDENIFIED BY ‘密码’ ;</p>
<h5 id="修改用户密码"><a href="#修改用户密码" class="headerlink" title="修改用户密码"></a>修改用户密码</h5><p>​        ALTER USER ‘用户名’ @ ‘主机名’ IDENIFIED  WITH  mysql_native_password BY ‘新密码’ ;</p>
<h5 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h5><p>​        DROP USER ‘用户名’ @ ‘主机名’ ;</p>
<h4 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h4><h5 id="查询权限"><a href="#查询权限" class="headerlink" title="查询权限"></a>查询权限</h5><p>​        SHOW GRANTS FOR ‘用户名’ @ ‘主机名’ ;</p>
<h5 id="授予权限"><a href="#授予权限" class="headerlink" title="授予权限"></a>授予权限</h5><p>​        GRANT 权限列表 ON 数据库名.表名 TO ‘用户名’ @ ‘主机名’ ;</p>
<h5 id="撤销权限"><a href="#撤销权限" class="headerlink" title="撤销权限"></a>撤销权限</h5><p>​        REVOKE 权限列表 ON 数据库名.表名 FROM ‘用户名’ @ ‘主机名’ ;</p>
<blockquote>
<p>注意 ! </p>
<ul>
<li>多个权限之间,使用逗号分隔</li>
<li>授权时,数据库名和表名可以使用 * 进行统配,代表所有 .</li>
</ul>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">权限</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ALL,ALL,PRIVILEGES</td>
<td style="text-align:center">所有权限</td>
</tr>
<tr>
<td style="text-align:center">SELECT</td>
<td style="text-align:center">查询数据</td>
</tr>
<tr>
<td style="text-align:center">INLECT</td>
<td style="text-align:center">插入数据</td>
</tr>
<tr>
<td style="text-align:center">UPDATE</td>
<td style="text-align:center">修改数据</td>
</tr>
<tr>
<td style="text-align:center">DELETE</td>
<td style="text-align:center">删除数据</td>
</tr>
<tr>
<td style="text-align:center">ALTER</td>
<td style="text-align:center">修改表</td>
</tr>
<tr>
<td style="text-align:center">DROP</td>
<td style="text-align:center">删除数据库/表/视图</td>
</tr>
<tr>
<td style="text-align:center">CREATE</td>
<td style="text-align:center">创建数据库/表</td>
</tr>
</tbody>
</table>
</div>
<p>​    </p>
<hr>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>函数是指一段可以直接被另一段程序调用的程序或代码</p>
<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CONCAT(S1,S2,S3,…..Sn)</td>
<td style="text-align:center">字符串拼接,将S1,S2,…Sn拼接成一个字符串</td>
</tr>
<tr>
<td style="text-align:center">LOWER(str)</td>
<td style="text-align:center">将字符串str全部转为小写</td>
</tr>
<tr>
<td style="text-align:center">UPPER(str)</td>
<td style="text-align:center">将字符串str全部转为大写</td>
</tr>
<tr>
<td style="text-align:center">LPAD(str,n,pad)</td>
<td style="text-align:center">左填充,用字符串pad对str的左边进行填充,达到n个字符串长度</td>
</tr>
<tr>
<td style="text-align:center">RPAD(str,n,pad)</td>
<td style="text-align:center">左填充,用字符串pad对str的左边进行填充,达到n个字符串长度</td>
</tr>
<tr>
<td style="text-align:center">TRIM(str)</td>
<td style="text-align:center">去掉字符串头部和尾部的空格</td>
</tr>
<tr>
<td style="text-align:center">SUBSTRING(str,start,len)</td>
<td style="text-align:center">返回从字符串str从start位置起的len个长度的字符串</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>语法</li>
</ul>
<p>SELECT 函数() ;</p>
<hr>
<h3 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CEIL(x)</td>
<td style="text-align:center">向上取整</td>
</tr>
<tr>
<td style="text-align:center">FLOOR(x)</td>
<td style="text-align:center">向下取整</td>
</tr>
<tr>
<td style="text-align:center">MOD(x , y)</td>
<td style="text-align:center">返回X / Y 的模</td>
</tr>
<tr>
<td style="text-align:center">RAND()</td>
<td style="text-align:center">返回0~1内的随机数</td>
</tr>
<tr>
<td style="text-align:center">ROUND(x , y)</td>
<td style="text-align:center">求参数X的四舍五入的值,保留y位小数</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CURDATE()</td>
<td style="text-align:center">返回当前日期</td>
</tr>
<tr>
<td style="text-align:center">CURTIME()</td>
<td style="text-align:center">返回当前时间</td>
</tr>
<tr>
<td style="text-align:center">NOW()</td>
<td style="text-align:center">返回当前日期和时间</td>
</tr>
<tr>
<td style="text-align:center">YEAR(data)</td>
<td style="text-align:center">获取指定date的年份</td>
</tr>
<tr>
<td style="text-align:center">MONTH(date)</td>
<td style="text-align:center">获取指定date的月份</td>
</tr>
<tr>
<td style="text-align:center">DAY(date)</td>
<td style="text-align:center">获取指定date的日期</td>
</tr>
<tr>
<td style="text-align:center">DATE_ADD(date,INTERVAL expr type)</td>
<td style="text-align:center">返回一个日期 / 时间值加上一个时间间隔expr后的时间值</td>
</tr>
<tr>
<td style="text-align:center">DATEDIFF(date 1, date 2)</td>
<td style="text-align:center">返回起始时间date 1 和结束时间data 2之间的天数</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="流程函数"><a href="#流程函数" class="headerlink" title="流程函数"></a>流程函数</h3><p>流程函数也是很常用的一类函数,可以在SQL语句中实现条件筛选,从而提高语句的效率</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IF(value , t , f)</td>
<td style="text-align:center">如果value为true,则返回t,否则返回f</td>
</tr>
<tr>
<td style="text-align:center">IFNULL(value1, value2)</td>
<td style="text-align:center">如果value1不为空，返回value1，否则返回value2</td>
</tr>
<tr>
<td style="text-align:center">CASE WHEN [val1 ] THEN [res1] … ELSE[ default] END</td>
<td style="text-align:center">如果val1为true，返回res1，… 否则返回default默认值</td>
</tr>
<tr>
<td style="text-align:center">CASE[ expr] WHEN [val1 ] THEN [res1] … ELSE[ default] END</td>
<td style="text-align:center">如果expr的值等于val1，返回res1，… 否则返回default默认值</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><h3 id="常见约束"><a href="#常见约束" class="headerlink" title="常见约束"></a>常见约束</h3><ul>
<li>概念: 约束是作用于表中字段上的规则, 用于限制储存在表中的数据</li>
<li>目的: 保证数据库中数据的正确性, 有效性和完整性</li>
<li>分类</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">约束</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">非空约束</td>
<td style="text-align:center">限制该字段的数据不能为null</td>
<td style="text-align:center">NOT NULL</td>
</tr>
<tr>
<td style="text-align:center">唯一约束</td>
<td style="text-align:center">保证该字段的所有数据都是唯一的,不重复的</td>
<td style="text-align:center">UNIQE</td>
</tr>
<tr>
<td style="text-align:center">主键约束</td>
<td style="text-align:center">主键是一行数据的唯一标识,要求非空且唯一</td>
<td style="text-align:center">PRIMARY KEY</td>
</tr>
<tr>
<td style="text-align:center">默认约束</td>
<td style="text-align:center">保存数据时,如果为指定该字段的值,则采用默认值</td>
<td style="text-align:center">DEFAULT</td>
</tr>
<tr>
<td style="text-align:center">检查约束(8.0.16版本之后)</td>
<td style="text-align:center">保证字段值满足某一条件</td>
<td style="text-align:center">CHECK</td>
</tr>
<tr>
<td style="text-align:center">外键约束</td>
<td style="text-align:center">用来让两张表的数据之间建立链接,保证数据的一致性和完整性</td>
<td style="text-align:center">FOREIGN KEY</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>注意 ! </p>
<ul>
<li>约束时作用于表中字段上的, 可以在创建表 / 修改表的时候添加约束</li>
<li>AUTO INCREMENT 自动增长约束</li>
</ul>
</blockquote>
<h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><ul>
<li><p>概念: 外键用来让两张表的数据之间建立链接,从而保证数据的一致性和完整性 .</p>
</li>
<li><p>语法</p>
<p>​    ~ 添加外键</p>
<p>​    CREATE TABLE 表名(<br>​        字段名 数据类型</p>
<p>​        …</p>
<p>​        [CONSTRAINT[外键名称] FOREIGN KEY(外键字段名) REFERENCES 主表(主表列名)</p>
<p>);</p>
<p>ALTER TABLE 表名 ADD CONSTRAINT 外铺名称 FOREIGN KEY(外键字段名) REFERENCES 主表(主表列名) ;</p>
<p>~删除 / 更新行为</p>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">行为</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">NO ACTION</td>
<td style="text-align:center">当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除 / 更新。(与 RESTRICT一致)</td>
</tr>
<tr>
<td style="text-align:center">RESTRICT</td>
<td style="text-align:center">当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除 / 更新。(与 NO ACTION 一致)</td>
</tr>
<tr>
<td style="text-align:center">CASCADE</td>
<td style="text-align:center">当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有，则也删除 / 更新外键在子表中的记录。</td>
</tr>
<tr>
<td style="text-align:center">SET NULL</td>
<td style="text-align:center">当在父表中删除对应记录时，首先检查该记录是否有对应外键，如果有则设置子表中该外键值为(这就要求该外键允许取null)。</td>
</tr>
<tr>
<td style="text-align:center">SET DEFAULT</td>
<td style="text-align:center">父表有变更时，子表将外键列设置成一个默认的值(Innodb不支持)</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>语法</p>
<p>ALTER TABLE 表名 ADD CONSTRAIN 外键名称 FOREIGN KEY (外键字段) REFERENCES 主表名(主表字段名) ON UPDATE CASCADE ON DELETE CASCADE ;</p>
</li>
</ul>
<hr>
<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><h3 id="多表关系"><a href="#多表关系" class="headerlink" title="多表关系"></a>多表关系</h3><ul>
<li><p>概述</p>
<p>项目开发中,在进行数据库表结构设计时,会根据业务需求及业务模块之间的关系,分析并设计表结构,由于业务之间相互关联,所一个个表结构之间也存在着各种联系,基本上分为三种 : </p>
<ul>
<li><p>一对多(多对一)</p>
</li>
<li><p>多对多</p>
</li>
<li>一对一 : 多用于单表拆分,将一张表的基础字段放在一张表中,其他详情字段放在另一张表中,以提升操作效率</li>
</ul>
</li>
</ul>
<hr>
<h3 id="多表查询概述"><a href="#多表查询概述" class="headerlink" title="多表查询概述"></a>多表查询概述</h3><ul>
<li>概述: 指从多张表中查询数据</li>
<li>笛卡尔积: 笛卡尔乘积是指在数学中, 两个集合A集合 和 B集合的所有组合情况.(在多表查询时 , 需要消除无效的笛卡尔积)</li>
</ul>
<hr>
<h3 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h3><p>内连接查询语法:</p>
<ul>
<li><p>隐式内连接</p>
<p>SELECT 字段列表 FROM 表1,表2 WHERE 条件… ;</p>
</li>
<li><p>显式内连接</p>
<p>SELECT 字段列表 FROM 表1 [INNER] JOIN 表2 ON 连接条件… ;</p>
</li>
</ul>
<blockquote>
<p>内连接查询的时两张表交集的部分</p>
</blockquote>
<hr>
<h3 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h3><p>外连接查询语法:</p>
<ul>
<li><p>左外连接</p>
<p>SELECT 字段列表 FROM 表1 LEFT [OUTER] JOIN 表2 ON 条件… ;</p>
<blockquote>
<p>先当于查询表1(左表)的所有数据 包含 表1和表2交集部分的数据</p>
</blockquote>
</li>
<li><p>右外链接</p>
<p>SELECT 字段列表 FROM 表1 RIGHT [OUTER] JOIN 表2 ON 条件 … ;</p>
<blockquote>
<p>相当于查询表2(右表)的所有数据 包含 表1和表2交集部分的数据</p>
</blockquote>
</li>
</ul>
<hr>
<h3 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h3><p>自连接查询语法: </p>
<p>SELECT 字段列表 FROM 表A 别名A JOIN 表A 别名B ON 条件 … ;</p>
<p>自连接查询,可以是内连接查询,也可以是外连接查询 .</p>
<hr>
<h3 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h3><p>对于union查询,就是把多次查询的结果合并起来,形成一个新的查询结果集.</p>
<p>SELECT 字段列表 FROM 表A …</p>
<p>UNION [ALL]</p>
<p>SELECT 字段列表 FROM 表B ;</p>
<blockquote>
<p>对于联合查询的多张表的列数必须保持一致 , 字段类型也需要保持一致 .</p>
<p>union all 会将全部的数据直接合并在一起 , union会对合并之后的数据去重 .</p>
</blockquote>
<hr>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><ul>
<li><p>概念 : SQL语句中嵌套SELECT语句 , 称为嵌套查询 , 又称子查询 .</p>
<p>SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2) ;</p>
</li>
<li><p>根据子查询的结果不同 , 分为 : </p>
<ul>
<li>标量子查询 (子查询结果为单个值)</li>
<li>列子查询 (子查询结果为一列)</li>
<li>行子查询 (子查询结果为一行)</li>
<li>表子查询 (子查询结果为多行多列)</li>
</ul>
</li>
<li><p>根据子查询的位置不同 , 分为 :</p>
<ul>
<li>WHERE之后</li>
<li>FROM之后</li>
<li>SELECT之后</li>
</ul>
</li>
</ul>
<h4 id="标量子查询"><a href="#标量子查询" class="headerlink" title="标量子查询"></a>标量子查询</h4><p>​    子查询返回的结果是单个值(数字 , 字符串 , 日期等) , 最简单的形式 , 这种子查询称为标量子查询</p>
<p>​    常用的操作符 : =  &lt;&gt;  &gt;  &gt;=  &lt;  &lt;=</p>
<hr>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h3 id="事务的简介"><a href="#事务的简介" class="headerlink" title="事务的简介"></a>事务的简介</h3><p>​    事务是一组操作的集合 , 他是一个不可分割的工作单位 , 事务所会把所有的操作作为一个整体一起向系统提交或撤销操作请求 , 即这些操作要么同时成功 , 要么同时失败 .</p>
<h3 id="事务操作"><a href="#事务操作" class="headerlink" title="事务操作"></a>事务操作</h3><p>方式一 :</p>
<ul>
<li><p>查看 / 设置事务的提交方式</p>
<p>SELECT @@autocommit ;</p>
<p>SET @@autocommit = 0 ;   //设置为手动提交</p>
</li>
<li><p>提交事务</p>
<p>COMMIT ;</p>
</li>
<li><p>回滚事务</p>
<p>ROLLBACK ;</p>
</li>
</ul>
<p>方式二 :</p>
<ul>
<li><p>开启事务</p>
<p>START TRANSACTION 或 BEGIN ;</p>
</li>
<li><p>提交事务</p>
<p>COMMIT ;</p>
</li>
<li><p>回滚事务</p>
<p>ROLLBACK ;</p>
</li>
</ul>
<h3 id="事务的四大特性"><a href="#事务的四大特性" class="headerlink" title="事务的四大特性"></a>事务的四大特性</h3><ul>
<li>原子性 (Atomicity) : 事务是不可分割的最小单元 , 要么全部成功 , 要么全部失败 .</li>
<li>一致性 (Consistency) : 事务完成时 , 必须使用所有的数据都保持一致状态 .</li>
<li>隔离性 (Isolation) : 数据库系统提供的隔离机制 , 保证十五在不受外部并发操作影响的独立环境下运行 .</li>
<li>持久性 (Durability) : 事务一旦提交或回滚 , 它对数据库中的数据的改变就是永久的 .</li>
</ul>
<h3 id="并发事务问题"><a href="#并发事务问题" class="headerlink" title="并发事务问题"></a>并发事务问题</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">问题</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">脏读</td>
<td style="text-align:center">一个事务读到另外一个事务还没有提交的数据.</td>
</tr>
<tr>
<td style="text-align:center">不可重复读</td>
<td style="text-align:center">一个事务先后读取同一条记录 , 但两次读取的数据内容不同 , 称之为不可重复读</td>
</tr>
<tr>
<td style="text-align:center">幻读</td>
<td style="text-align:center">一个事务按照条件查询数据时,没有对象的数据行,但是在插入数据时,又发现这行数据已经存在,好像出现了”幻影”.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">隔离级别</th>
<th style="text-align:center">脏读</th>
<th style="text-align:center">不可重复读</th>
<th style="text-align:center">幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Read uncommitted</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">Read committed</td>
<td style="text-align:center">×</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">Repeatable Read (默认)</td>
<td style="text-align:center">×</td>
<td style="text-align:center">×</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">Serializable</td>
<td style="text-align:center">×</td>
<td style="text-align:center">×</td>
<td style="text-align:center">×</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>查看事务的隔离级别</p>
<p>SELECT @@TRANSACTION_ISOLATION ;</p>
</li>
<li><p>设置事务隔离级别</p>
<p>SET [ SESSION | GLOBAL ] TRANSACTION ISOLATION LEVEL { READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE }</p>
</li>
</ul>
<blockquote>
<p>注意 !</p>
<ul>
<li>事务的隔离级别越高  , 数据越安全 , 但是性能越低 .</li>
</ul>
</blockquote>
<hr>
<h1 id="MySQL进阶"><a href="#MySQL进阶" class="headerlink" title="MySQL进阶"></a>MySQL进阶</h1><hr>
<h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><h3 id="MySQL体系结构"><a href="#MySQL体系结构" class="headerlink" title="MySQL体系结构"></a>MySQL体系结构</h3><ul>
<li><p>连接层 :连接池</p>
<p>最上层是一些客户端和连接服务 , 主要完成一些类似于连接处理 , 授权认证 , 及相关的安全方案 . 服务器也会为安全接入的每个客户端验证它所具有的操作权限 .</p>
</li>
</ul>
<ul>
<li><p>服务层 : SQL接口  解析器  查询优化器  缓存</p>
<p>第二层架构主要完成大多数的核心服务功能 , 如SQL接口 , 并完成缓存的查询 , SQL的分析和优化 , 部分内置函数的执行 . 所有跨存储引擎的功能也在这一层实现 , 如 过程 , 函数等 .</p>
</li>
</ul>
<ul>
<li><p>引擎层 : 可插拔存储引擎</p>
<p>存储引擎真正的负责了MySQL中数据的存储和提取 , 服务器通过API和存储引擎进行通信 . 不同的存储引擎具有不同的功能 , 这样我们可以根据自己的需要来选取合适的存储引擎 .</p>
</li>
</ul>
<ul>
<li><p>存储层 : 系统文件  文件和日志</p>
<p>主要是将数据存储在文件系统之上 , 并完成与储存引擎的交互 .</p>
</li>
</ul>
<h3 id="存储引擎简介"><a href="#存储引擎简介" class="headerlink" title="存储引擎简介"></a>存储引擎简介</h3><p>存储引擎就是存储数据 , 建立索引 , 跟新 / 查询数据等技术的实现方式 . 存储引擎是基于表的 , 而不是基于库的 , 所以存储引擎也可以被称为表类型 . </p>
<p>在创建表是,指定存储引擎</p>
<p>​    CREATE TABLE 表名(</p>
<p>​        字段1 字段1类型 [COMMENT 字段1注释]</p>
<p>​        ……</p>
<p>​        字段n 字段n类型 [COMMENT 字段n注释]</p>
<p>)    ENGINE = INNODB [COMMENT 表注释] ;</p>
<h3 id="存储引擎特点"><a href="#存储引擎特点" class="headerlink" title="存储引擎特点"></a>存储引擎特点</h3><h4 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h4><ul>
<li><p>介绍 :</p>
<p>InnoDB是一种兼顾高可靠性和高性能的通用存储引擎 , 在MySQL 5.5 之后 , InnoDB是默认的MySQL存储引擎 .</p>
</li>
<li><p>特点 :</p>
<p>DML操作遵循ACID模型 , 支持事务 ;</p>
<p>行级锁 , 提高并发访问性能 ;</p>
<p>支持外键 FOREIGN KEY 约束 , 保证数据的完整性和正确性 ;</p>
</li>
<li><p>文件 :</p>
<p>xxx.ibd:xxx代表的是表名innoDB引擎的每张表都会对应这样一个表空间文件，存储该表的表结构(frm、sdi)、数据和索引。</p>
<p>参数:innodb file_per table</p>
</li>
</ul>
<h4 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h4><ul>
<li><p>介绍</p>
<p>MyISAM是MySQL早期的默认储存引擎 .</p>
</li>
<li><p>特点</p>
<p>不支持事务 , 不支持外键</p>
<p>支持表锁 , 不支持表锁</p>
<p>访问速度快</p>
</li>
</ul>
<h4 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h4><ul>
<li><p>介绍</p>
<p>Memory引擎的表数据是存储在内存中的 , 由于受到硬件问题 , 或断电问题的影响 , 只能将这些表作为临时表或缓存使用</p>
</li>
<li><p>特点</p>
<p>内存存放</p>
<p>hash索引 (默认)</p>
</li>
<li><p>文件</p>
<p>xxx.sdi : 储存表结构信息</p>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">特点</th>
<th style="text-align:center">InnoDB</th>
<th style="text-align:center">MyISAM</th>
<th style="text-align:center">Memory</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">存储限制</td>
<td style="text-align:center">64TB</td>
<td style="text-align:center">有</td>
<td style="text-align:center">有</td>
</tr>
<tr>
<td style="text-align:center">事务安全</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">锁机制</td>
<td style="text-align:center">行锁</td>
<td style="text-align:center">表锁</td>
<td style="text-align:center">表锁</td>
</tr>
<tr>
<td style="text-align:center">B+tree索引</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">Hash索引</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">全文索引</td>
<td style="text-align:center">支持(5.6版本之后)</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">空间使用</td>
<td style="text-align:center">高</td>
<td style="text-align:center">低</td>
<td style="text-align:center">N/A</td>
</tr>
<tr>
<td style="text-align:center">内存使用</td>
<td style="text-align:center">高</td>
<td style="text-align:center">低</td>
<td style="text-align:center">中等</td>
</tr>
<tr>
<td style="text-align:center">批量插入速度</td>
<td style="text-align:center">低</td>
<td style="text-align:center">高</td>
<td style="text-align:center">高</td>
</tr>
<tr>
<td style="text-align:center">支持外键</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
</tbody>
</table>
</div>
<h3 id="存储引擎选择"><a href="#存储引擎选择" class="headerlink" title="存储引擎选择"></a>存储引擎选择</h3><p>在选择存储引擎时 , 应该根据应用系统的特点选择合适的存储引擎 . 对于复杂的应用系统 , 还可以根据实际情况选择多种存储引擎进行组合 .</p>
<ul>
<li>InnoDB : 是MySQL的默认存储引擎 , 支持事务 ,外键 . 如果应用对事务的完整性有比较高的要求 , 在并发条件下要求数据的一致性 , 数据操作除了插入和查询之外 , 还包含很多的更新 , 删除操作 , 那么InnoDB存储引擎是比较合适的选择</li>
<li>MyISAM : 如果应用是以读操作和插入操作为主 , 只有很少的更新和删除操作 , 并且对事务的完整性 , 并发性要求不是很高 , 那么选择这个存储引擎是非常合适的 .</li>
<li>MEMORY : 将所有的数据保存在内存中 , 访问速度快 , 通常用于临时表及缓存 . MEMORY的缺陷就是对表的大小有限制 , 太大的表无法缓存在内存中 , 而且无法保障数据的安全性 .</li>
</ul>
<hr>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h3 id="索引概述"><a href="#索引概述" class="headerlink" title="索引概述"></a>索引概述</h3><ul>
<li><p>介绍</p>
<p>索引(index) 是帮助MySQL高效获取数据的数据结构(有序) . 在数据之外 , 数据库系统还维护者满足特定查找算法的数据结构 , 这些数据结构以某种方式引用 (指向) 数据 , 这样就可以在这些数据结构上实现高级查找算法 , 这种数据结构就是索引 .</p>
</li>
</ul>
<h3 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h3><p>​    MySQL的索引是在存储引擎层实现的 , 不同的存储引擎有不同的结构 , 主要包含以下集中 :</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">索引结构</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">B + Tree索引</td>
<td style="text-align:center">最常见的索引类型, 大部分引擎都支持B+ 树索引</td>
</tr>
<tr>
<td style="text-align:center">Hash索引</td>
<td style="text-align:center">底层数据结构是用哈希表实现的,只有精确匹配索引列的查询才有效,不支持范围查询</td>
</tr>
<tr>
<td style="text-align:center">R - tree(空间索引)</td>
<td style="text-align:center">空间索引是MyISAM引擎的一个特殊索引类型,主要用于地理空间数据类型,通常使用较少</td>
</tr>
<tr>
<td style="text-align:center">Full - text(全文索引)</td>
<td style="text-align:center">是一种通过建立倒排索引,快速匹配文档的方式.类似于Lucene ,Solr , ES</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">索引</th>
<th style="text-align:center">InnoDB</th>
<th style="text-align:center">MySQL</th>
<th style="text-align:center">Memory</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">B + Tree索引</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">Hash索引</td>
<td style="text-align:center">不支持</td>
<td style="text-align:center">不支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">R - tree索引</td>
<td style="text-align:center">不支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">Full - text</td>
<td style="text-align:center">5.6版本之后支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">不支持</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>二叉树缺点</p>
<p>顺序插入是 , 会形成一个链表 , 查询性能大大降低 . 大数据量情况下 , 层级较深 , 检索速度慢 .</p>
</li>
<li><p>红黑树</p>
<p>大数据量情况下 , 层级较深 ,检索速度慢 .</p>
</li>
<li><p>B + Tree </p>
<p>MySQL索引数据结构对经典的B + Tree 进行了优化 . 在原B + Tree 的基础上增加了一个指向相邻叶子节点的链表指针 , 就形成了带有顺序指针的B + Tree  , 提高区间访问的性能 .</p>
</li>
<li><p>Hash</p>
<p>哈希索引就是采用一定的Hash算法 , 将键值换算成新的Hash值 , 映射到对应的槽位上 , 然后存储在Hash表中 .</p>
<p>如果两个(或多个)键值 , 映射到到一个相同槽位上 , 他们就产生了Hash冲突 (也成为Hash碰撞) , 可以通过链表来解决 .</p>
<ul>
<li><p>特点</p>
<p>Hash索引只能用于对等比较(= , in) , 不支持范围查询 (between , &gt; , &lt; , …)</p>
<p>无法利用索引完成排序操作</p>
<p>查询效率高 , 通常只需要一次检索就可以了 , 效率通常要高于B + Tree索引</p>
</li>
</ul>
<p>在MySQL中 , 支持Hash索引的是Memory引擎 , 而InnoDB中具有自适应Hash功能 , Hash索引是存储引擎根据B + Tree索引在指定条件下自动构建的 .</p>
</li>
</ul>
<h3 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a>索引分类</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">分类</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">特点</th>
<th style="text-align:center">关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">主键索引</td>
<td style="text-align:center">针对于表中主键创建的索引</td>
<td style="text-align:center">默认自动创建,只能有一个</td>
<td style="text-align:center">PRIMARY</td>
</tr>
<tr>
<td style="text-align:center">唯一索引</td>
<td style="text-align:center">避免同一个表中某数据列中的值重复</td>
<td style="text-align:center">可以有多个</td>
<td style="text-align:center">UNIQUE</td>
</tr>
<tr>
<td style="text-align:center">常规索引</td>
<td style="text-align:center">快速定位特定数据</td>
<td style="text-align:center">可以有多个</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">全文索引</td>
<td style="text-align:center">全文索引查找的是文本中的关键词 , 而不是比较索引中的值</td>
<td style="text-align:center">可以有多个</td>
<td style="text-align:center">FULLTEXT</td>
</tr>
</tbody>
</table>
</div>
<p>在InnoDB存储引擎中 , 根据索引的存储形式 , 又可以分为以下两种 : </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">分类</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">特点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">聚集索引</td>
<td style="text-align:center">将数据存储与索引放到了一块,索引结构的叶子节点保存了行数据</td>
<td style="text-align:center">必须有,而且只有一个</td>
</tr>
<tr>
<td style="text-align:center">二级索引</td>
<td style="text-align:center">将数据与索引分开储存,索引结构的叶子节点关联的是对应的主键</td>
<td style="text-align:center">可以存在多个</td>
</tr>
</tbody>
</table>
</div>
<p>救济索引选取规则:</p>
<ul>
<li>如果存在主键 , 主键索引就是聚集索引</li>
<li>如果不存在主键 , 将使用第一唯一 (UNIQUE) 索引作为聚集索引</li>
<li>如果表没有主键 , 或没有合适的唯一索引 , 则InnoDB会自动生成一个rowid作为隐藏的聚集索引 .</li>
</ul>
<h3 id="索引语法"><a href="#索引语法" class="headerlink" title="索引语法"></a>索引语法</h3><ul>
<li><p>创建索引</p>
<p>CREATE [UNIQUE | FULLTEXT] INDEX index_name ON table_name (index_col_name,…) ;</p>
</li>
<li><p>查看索引</p>
<p>SHOW INDEX FROM table_name ;</p>
</li>
<li><p>删除索引</p>
<p>DROP INDEX index_name ON table_name ;</p>
</li>
</ul>
<h3 id="SQL性能分析"><a href="#SQL性能分析" class="headerlink" title="SQL性能分析"></a>SQL性能分析</h3><ul>
<li><p>SQL执行频率</p>
<p>MySQL客户端连接成功后 , 通过show [session  |  global ]  status 命令可以提供服务器状态信息 . 通过加入下指令 , 可以查看当前数据库的INSERT , UPDATE , DELETE , SELECT的访问频次 ;</p>
<p>SHOW  GLOBAL  STAUS  LIKE  ‘Com<em>_</em>‘ ;</p>
</li>
<li><p>慢查询日志</p>
<p>慢查询日志记录了所有执行时间超过指定参数 (long_quert_time , 单位 : 秒 , 默认10秒) 的所有SQL语句的日志</p>
<p>MySQL的慢查询日志默认没有开启 , 需要在MySQL的配置文件 (/etc/my.cnf) 中配置如下信息 :</p>
</li>
</ul>
<blockquote>
<h1 id="开启MySQL慢日志查询开关"><a href="#开启MySQL慢日志查询开关" class="headerlink" title="开启MySQL慢日志查询开关"></a>开启MySQL慢日志查询开关</h1><p>slow_query_log = 1</p>
<h1 id="设置慢日志的时间为2秒-SQL语句执行时间超过2秒-就会视为慢查询-记录慢查询日志"><a href="#设置慢日志的时间为2秒-SQL语句执行时间超过2秒-就会视为慢查询-记录慢查询日志" class="headerlink" title="设置慢日志的时间为2秒 ,SQL语句执行时间超过2秒 , 就会视为慢查询 , 记录慢查询日志"></a>设置慢日志的时间为2秒 ,SQL语句执行时间超过2秒 , 就会视为慢查询 , 记录慢查询日志</h1><p>long_quert_time = 2</p>
</blockquote>
<p>  配置完毕之后，通过以下指令重新启动MySQL服务器进行测试，查看慢日志文件中记录的信息 var/lib/mysq/localhost-slow.log.</p>
<ul>
<li><p>profile详情</p>
<p>show profiles 能够在做SQL优化时帮助我们了解时间都耗费到哪里去了。通过have profiling参数，能够看到当前MySQL是否支持<br>profile操作:</p>
<p>SELECT @@have_profiling ;</p>
<p>执行一系列的业务SQL的操作 , 然后通过如下指令查看指令的执行耗时:</p>
<blockquote>
<h1 id="查看每一条SQL的好事基本情况"><a href="#查看每一条SQL的好事基本情况" class="headerlink" title="查看每一条SQL的好事基本情况"></a>查看每一条SQL的好事基本情况</h1><p>show profiles ;</p>
<h1 id="查看指定query-id的SQL语句各个阶段的耗时情况"><a href="#查看指定query-id的SQL语句各个阶段的耗时情况" class="headerlink" title="查看指定query_id的SQL语句各个阶段的耗时情况"></a>查看指定query_id的SQL语句各个阶段的耗时情况</h1><p>show profile for query query_id ;</p>
<h1 id="查看指定query-id的SQL语句CPU的使用情况"><a href="#查看指定query-id的SQL语句CPU的使用情况" class="headerlink" title="查看指定query_id的SQL语句CPU的使用情况"></a>查看指定query_id的SQL语句CPU的使用情况</h1><p>show profile cpu for query query_id ;</p>
</blockquote>
</li>
<li><p>explain执行计划</p>
<p>EXPLAIN或者DESC命令获取MySQL如何执行SELECT语句的信息 , 包括在SELECT语句执行过程中表如何连接和连接的顺序</p>
<p>语法</p>
<blockquote>
<h1 id="直接在select语句之前加上关键字-explain-desc"><a href="#直接在select语句之前加上关键字-explain-desc" class="headerlink" title="直接在select语句之前加上关键字 explain / desc"></a>直接在select语句之前加上关键字 explain / desc</h1><p>EXPLAIN  SELECT  字段列表  FROM  表名  WHERE  条件  ;</p>
</blockquote>
<p>EXPLAIN 执行计划个字段含义 :</p>
<ul>
<li><p>ID</p>
<p>select查询的序列号 , 表示查询中执行sekect子句或者是操作表的顺序(id相同 , 执行顺序从上到下 ; id不同 , 值越大 , 越先执行) ;</p>
</li>
<li><p>select type</p>
<p>表示SELECT 的类型，常见的取值有 SIMPLE(简单表，即不使用表连接或者子查询)、PRIMARY(主查询，即外层的查询)UNION(UNION 中的第二个或者后面的查询语句)、SUBQUERY(SELECT/WHERE之后包含了子查询)等</p>
</li>
<li><p>type</p>
<p>表示连接类型，性能由好到差的连接类型为NULL、System、const、eg ref、ref、range、index、all。</p>
</li>
<li><p>possible key</p>
<p>显示可能应用在这张表上的索引 , 一个或多个 .</p>
</li>
<li><p>Key</p>
<p>实际使用的索引 , 如果为NULL , 则没有使用索引 .</p>
</li>
<li><p>Ken_len</p>
<p>表示索引中使用的字节数 , 该值为索引字段最大可能长度 , 并非实际使用长度 , 再不损失精确性的前提下 , 长度越短越好.</p>
</li>
<li><p>rows</p>
<p>MySQL认为必须要执行查询的行数 , 在innodb引擎的表中 , 是一个估计值 , 可能并不总是准确的 .</p>
</li>
<li><p>filtered</p>
<p>表示返回结果的行数占所需读取行数的百分比 , filtered的值越大越好 .</p>
</li>
</ul>
</li>
</ul>
<h3 id="索引使用"><a href="#索引使用" class="headerlink" title="索引使用"></a>索引使用</h3><ul>
<li><p>验证索引效率</p>
<ul>
<li><p>在未建立索引之前 , 执行如下SQL语句 , 查看SQL的耗时 . </p>
<blockquote>
<p>SELECT * FEOM tb_sku WHERE sn =  ‘100000003145001’ ;</p>
</blockquote>
</li>
<li><p>针对字段创建索引</p>
<blockquote>
<p>create  index  idx_sku _sn on tb_sku(sn) ;</p>
</blockquote>
</li>
<li><p>然后再次执行相同的SQL语句 , 再次查看SQL的耗时</p>
<blockquote>
<p>SELECT * FEOM tb_sku WHERE sn =  ‘100000003145001’ ;</p>
</blockquote>
</li>
</ul>
</li>
<li><p>最左前缀法则</p>
<p>如果索引了多列 (联合索引) , 要遵守最左前缀法则 . 最左前缀法则值得是查询从索引的最左列开始 , 并且不跳过索引中的列 . </p>
<p>如果跳跃某一列 , 索引将部分失效 (后面的字段索引失效)</p>
</li>
<li><p>范围查询</p>
<p>联合索引中 , 出现范围查询 ( &gt; ,  &lt; ) , 范围查询右侧的列索引失效</p>
</li>
<li><p>索引列运算</p>
<p>不要再索引列上进行运算操作 , 索引将失效 .</p>
<p>explain select * from tb_user where substring(phone , 10 ,2) =  ‘ 15 ‘ ;</p>
</li>
<li><p>字符串不加引号</p>
<p>字符串类型字段使用时 , 不加引号 ,索引将失效</p>
</li>
<li><p>模糊查询</p>
<p>如果仅仅是尾部模糊匹配 , 索引不会失效 . 如果是头部模糊匹配 ,索引失效.</p>
</li>
<li><p>or连接的条件</p>
<p>用or分割开的条件,如果or前的条件中的列有索引 ,而后面的列中没有索引 , 那么涉及的索引都不会被用到 .</p>
</li>
</ul>
<ul>
<li><p>SQL提示</p>
<p>SQL提示 , 是优化数据库的一个重要手段 , 简单来说 , 就是在SQL语句中加入一些认为的提示来达到优化操作的目的.</p>
<p>use index :</p>
<blockquote>
<p>explain select * from tb_user use index (idx_use_pro) where profession = ‘软件工程’ ;</p>
</blockquote>
<p>ignore index :</p>
<blockquote>
<p>explain select * from tb_user ignore index (idx_user_pro) where profession = ‘软件工程’ ;</p>
</blockquote>
</li>
<li><p>force index :</p>
<blockquote>
<p>explain select * from tb_user force index (idx_user_pro) where profession = ‘软件工程’ ;</p>
</blockquote>
</li>
<li><p>覆盖索引</p>
<p>尽量使用覆盖索引 (查询使用了索引, 并且需要返回的列 , 在该索引中已经全部能够找到) , 减少select  * .</p>
<blockquote>
<p>explain select id, profession from tb user where profession = 软件工程’ and age = 31 and status = ‘0’ ;</p>
<p>explain select id,profession,age, status from tb user where profession = 软件工程’and age = 31 and status = ‘0’  ;</p>
<p>explain select id,profession,age, status, name from tb user where profession = 件’and age = 31 and status = ‘0’ ;</p>
<p>explain select * from tb user where profession =软工程’ and age =31 and status = ‘0’ ;</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>using index condition : 查找使用了索引, 但是需要回表查询数据</p>
<p>using where ;using index : 查找使用了索引 , 但是需要的数据都在索引列中能找到 , 所以不需要回表查询数据</p>
</blockquote>
<ul>
<li><p>前缀索引</p>
<p>当前字段类型为字符串 (varcher , text等 )时 , 有时候需要索引很长的字符串 , 这会让索引变得很大 , 查询时 , 浪费大量的磁盘IO, 影响查询效率 . 此时可以只将字符串的一部分前缀 , 建立索引 , 这样可以大大节约索引空间 , 从而提高索引效率 .</p>
<ul>
<li><p>语法:</p>
<blockquote>
<p>create index idx_xxxx on table_name(column (n) );</p>
</blockquote>
</li>
<li><p>前缀长度</p>
<p>可以根据索引的选择性来决定 , 而选择性是指不重复的索引值 (基数) 和数据表的记录总数的比值 , 索引选择性越高则查询效率越高 , 唯一索引的选择性是 1 , 这是最好的索引选择性 , 性能也是最好的 .</p>
<blockquote>
<p>select count (distinct email) / count (*) from tb_user ;</p>
<p>select count (distinct substring (email , 1 , 5)) / count (*) from tb_user ;</p>
</blockquote>
</li>
</ul>
</li>
<li><p>单列索引与联合索引</p>
<p>单列索引 : 即一个索引只包含单个列 .</p>
<p>联合索引 : 即一个索引包含了多个列 .</p>
<p>在业务场景中 , 如果存在多个查询条件 , 考虑针对于查询字段建立索引时 , 建议建立联合索引 , 而非单列索引 . </p>
<ul>
<li><p>单列索引情况 : </p>
<blockquote>
<p>explain select id , phone , name from tb_user where phone = ‘17799990010’ and name = ‘韩信’ ;</p>
</blockquote>
</li>
</ul>
<p>多条件查询时 , MySQL优化器会评估那个字段的索引效率更高 , 会选择该索引完成本次查询 .</p>
</li>
</ul>
<h3 id="索引设计原则"><a href="#索引设计原则" class="headerlink" title="索引设计原则"></a>索引设计原则</h3><p>1.针对数据量较大 , 并且查询比较频繁的表建立索引</p>
<p>2.针对于常作为查询条件(where) , 排序(order by) , 分组(group by) 操作的字段建立索引</p>
<p>3.尽量选择区分度高的列作为索引 , 尽量建立唯一索引 , 区分度越高 , 使用索引的效率越高</p>
<p>4.如果时字符串类型的字段 , 字段的长度较长 , 可以针对于字段的特点 , 建立前缀索引</p>
<p>5.尽量使用联合索引 , 减少单列索引 , 查询时 , 联合索引很多时候可以覆盖索引 , 节省存储空间 , 避免回表 , 提高查询效率</p>
<p>6.要控制索引的数量 , 索引并不是多多益善 , 索引越多维护索引结构的代价也就越大 , 会影响增删改的效率</p>
<p>7.如果索引列不能储存NULL值 , 请在创建表时使用NOT NULL约束它 . 当优化器知道每列是否包含NULL值时 , 它可以更好地确定哪个索         引最有效地用于查询 .</p>
<hr>
<h2 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h2><h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><ul>
<li><p>insert优化</p>
<ul>
<li><p>批量插入</p>
<blockquote>
<p>Insert into tb_test balues(1, ‘TOM’) , (2 , ‘CAT’) , (3 , ‘JERRY’) ;</p>
</blockquote>
</li>
<li><p>手动提交事务</p>
<blockquote>
<p>start transaction ;</p>
<p>insert into tb_test values (1, ‘TOM’) , (2 , ‘CAT’) , (3 , ‘JERRY’) ;</p>
<p>insert into tb_test values (4, ‘TOM’) , (5 , ‘CAT’) , (6 , ‘JERRY’) ;</p>
<p>insert into tb_test values (7, ‘TOM’) , (8 , ‘CAT’) , (9 , ‘JERRY’) ;</p>
<p>commit ;</p>
</blockquote>
</li>
<li><p>主键顺序插入</p>
<blockquote>
<p>主键乱序插入 : 0    1    9    21    88    2    4    15    89    5    7    3</p>
<p>主键顺序插入 : 1    2    3    4    5    7    8    9    15    21    88    89</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>大批量插入数据</p>
<p>如果一次性需要插入大批量数据 , 使用insert语句插入性能较低 , 此时可以使用MySQL数据库提供的load指令进行插入 . </p>
<blockquote>
<h1 id="客户端连接服务端时-加上参数-—local-infile"><a href="#客户端连接服务端时-加上参数-—local-infile" class="headerlink" title="客户端连接服务端时 , 加上参数 —local-infile"></a>客户端连接服务端时 , 加上参数 —local-infile</h1><p>mysql —local-infile -u root -p ;</p>
<h1 id="设置全局参数local-infile为1-开启从本地加载文件导入数据的开关"><a href="#设置全局参数local-infile为1-开启从本地加载文件导入数据的开关" class="headerlink" title="设置全局参数local_infile为1 , 开启从本地加载文件导入数据的开关"></a>设置全局参数local_infile为1 , 开启从本地加载文件导入数据的开关</h1><p>set global local_infile = 1 ;</p>
<h1 id="执行load指令将准备好的数据-加载到表结构中"><a href="#执行load指令将准备好的数据-加载到表结构中" class="headerlink" title="执行load指令将准备好的数据 , 加载到表结构中"></a>执行load指令将准备好的数据 , 加载到表结构中</h1><p>load data local infile ‘/root/sql1.log’ into table ‘tb_user’ fuelds terminated by ‘,’ lines terminated by ‘\n’ ;</p>
</blockquote>
<p>主键顺序插入性能高于乱序插入</p>
</li>
</ul>
<h3 id="主键优化"><a href="#主键优化" class="headerlink" title="主键优化"></a>主键优化</h3><ul>
<li><p>数据组织方式</p>
<p>在InnoDB存储引擎中 , 表数据都是根据主键顺序组织存放的 , 这种存储方式的表称为索引组织表 (index organized table IOT).</p>
</li>
<li><p>页分裂</p>
<p>页可以为空 , 也可以填充一般 , 也可以填充100% . 煤业包含了2-N行数据(如果一行数据多大 , 会行溢出) , 根据主键排列 . </p>
</li>
<li><p>页合并</p>
<p>当删除一行记录时 , 实际上记录并没有被物理删除 , 只是记录被标记 (flaged) 为删除并且它的空间变得允许被其他记录声明使用 .</p>
<p>当页中删除的记录达到 MERGE_THRESHOLD (默认为页的50%) , InnoDB会开始寻找最靠近的页 (前或后) 看看是否可以将两个页合并以优化空间使用 .</p>
</li>
<li><p>主键的设计原则</p>
<blockquote>
<ul>
<li><p>满足业务需求的情况下 , 尽量降低主键的长度 .</p>
</li>
<li><p>插入数据时 , 尽量选择顺序插入 , 选择使用AUTO_INCREMENT自增主键</p>
</li>
<li><p>尽量给不要使用UUID做质检或者是其他自然主键 , 如身份证号</p>
</li>
<li><p>业务操作时, 避免对主键的修改</p>
</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="order-by优化"><a href="#order-by优化" class="headerlink" title="order by优化"></a>order by优化</h3><ul>
<li><p>.Using filesort : 通过表的索引或全表扫描 , 读取满足条件的数据行 , 然后在排序缓冲区sort buffer中完成操作排序 , 所有不是通过索引直接返回排序结果的排序都叫FileSort排序</p>
</li>
<li><p>.Using index : 通过有序索引顺序扫描直接返回有序数组 , 这种情况即为 using index , 不需要额外排序 , 操作效率高 .</p>
<blockquote>
<h1 id="没有创建索引时-根据age-phone-进行排序"><a href="#没有创建索引时-根据age-phone-进行排序" class="headerlink" title="没有创建索引时 , 根据age , phone 进行排序"></a>没有创建索引时 , 根据age , phone 进行排序</h1><p>explain select id , age , phone from tb_user order by age , phone ;</p>
<h1 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h1><p>create index idx_user_age_phone_aa on tb_user(age,phone);</p>
<h1 id="创建索引后-根据age-phone进行升序排序"><a href="#创建索引后-根据age-phone进行升序排序" class="headerlink" title="创建索引后 , 根据age , phone进行升序排序"></a>创建索引后 , 根据age , phone进行升序排序</h1><p>explain select id , age , phone from tb_user order by age , phone;</p>
<h1 id="创建索引后-根据age-phone进行降序排序"><a href="#创建索引后-根据age-phone进行降序排序" class="headerlink" title="创建索引后 , 根据age , phone进行降序排序"></a>创建索引后 , 根据age , phone进行降序排序</h1><p>explain select id , age , phone from tb_user order by age desc , phone desc ;</p>
</blockquote>
</li>
</ul>
<blockquote>
<h1 id="根据age-phone进行排序-一个升序-一个降序"><a href="#根据age-phone进行排序-一个升序-一个降序" class="headerlink" title="根据age , phone进行排序 , 一个升序 , 一个降序"></a>根据age , phone进行排序 , 一个升序 , 一个降序</h1><p>explain select id,age,phone from tb_user order by age asc , phone desc;</p>
<h1 id="创建索引-1"><a href="#创建索引-1" class="headerlink" title="创建索引"></a>创建索引</h1><p>create index idx_user_age-phone_ad on tb_user(age asc , phone desc);</p>
<h1 id="根据age-phone-进行排序-一个升序-一个降序"><a href="#根据age-phone-进行排序-一个升序-一个降序" class="headerlink" title="根据age ,phone 进行排序 一个升序 , 一个降序"></a>根据age ,phone 进行排序 一个升序 , 一个降序</h1><p>explain select id,age,phone from tb_user order by age asc , phone desc;</p>
<ul>
<li>根据排序字段建立合适的索引 , 多字段排序时 , 也遵循最左前缀法则 .</li>
<li>尽量使用覆盖索引</li>
<li>多字段排序 , 一个升序 , 一个降序 , 此时需要注意联合索引在创建时的规则(ASC/DESC)</li>
<li>如果不可避免的出现filesort , 大数据量排序是 , 可以适当增大排序缓冲区大小 , sort_buffer_size(默认256k)</li>
</ul>
</blockquote>
<h3 id="group-by优化"><a href="#group-by优化" class="headerlink" title="group by优化"></a>group by优化</h3><blockquote>
<h1 id="删除掉目前的联合索引idx-user-pro-age-sta"><a href="#删除掉目前的联合索引idx-user-pro-age-sta" class="headerlink" title="删除掉目前的联合索引idx user _pro age sta"></a>删除掉目前的联合索引idx user _pro age sta</h1><p>drop index idx user pro age sta on tb user;</p>
<h1 id="执行分组操作，根据profession字段分组"><a href="#执行分组操作，根据profession字段分组" class="headerlink" title="执行分组操作，根据profession字段分组"></a>执行分组操作，根据profession字段分组</h1><p>explain select profession , count(*) from tb user group by profession ;</p>
<h1 id="创建索引-2"><a href="#创建索引-2" class="headerlink" title="创建索引"></a>创建索引</h1><p>Create index idx user_pro age sta on tb user(profession , age , status);</p>
<h1 id="执行分组操作，根据profession字段分组-1"><a href="#执行分组操作，根据profession字段分组-1" class="headerlink" title="执行分组操作，根据profession字段分组"></a>执行分组操作，根据profession字段分组</h1><p>explain select profession , count(<em>) from tb user group by profession ;</em></p>
<p><em>#执行分组操作，根据profession字段分组</em></p>
<p><em>explain select profession , count(</em>) from tb user group by profession , age;</p>
</blockquote>
<h3 id="limit优化"><a href="#limit优化" class="headerlink" title="limit优化"></a>limit优化</h3><p>一个常见又非常头疼的问题就是 limit 2000000 , 10 , 此时需要MySQL排序前200010记录 , 进返回2000000 - 2000010 的记录 , 其他记录丢弃, 查询排序的代价非常大 .</p>
<p>优化思路 : 一般分页查询时 , 通过创建覆盖索引, 能够比较好地提高性能 , 可以通过覆盖索引加子查询形式进行优化</p>
<blockquote>
<p>explain select * from tb sku t , (select id from tb sku order by id limit 2000000,10) a where t.id = a.id;</p>
</blockquote>
<h3 id="count优化"><a href="#count优化" class="headerlink" title="count优化"></a>count优化</h3><blockquote>
<p>explain select count( * ) from tb_user ;</p>
</blockquote>
<ul>
<li>MyISAM 引擎把一个表的总行数存在了磁盘上，因此执行count(*)的时候会直接返回这个数，效率很高 .</li>
<li>InnoDB引擎就麻烦了，它执行 count(*)的时候，需要把数据一行一行地从引擎里面读出来，然后累积计数 .</li>
</ul>
<blockquote>
<ul>
<li>优化思路 : 自己计数 .</li>
</ul>
</blockquote>
<ul>
<li><p>count 的几种用法</p>
<blockquote>
<ul>
<li><p>count() 是一个聚合函数 , 对于返回的结果集 一一地进行判断 , 如果count函数的参数不是NULL , 累计值就加1 , 否则不加 , 最后返回累计值 .</p>
</li>
<li><p>用法: count (*) , count (主键) , count (字段) , count ( 1 ) .</p>
</li>
<li><p>InnoDB引擎会遍历整张表，把每一行的 主键id 值都取出来，返回给服务层。服务层拿到主键后，直接按行进行累加(主键不可能为nu)。</p>
</li>
<li><p>count (字段)<br>没有not nul 约束:InnoDB引会遍历整张表把每一行的字段值都取出来，返回给服务层，服务层判断是否为null，不为null，计数累加。有not null约束:InnoDB引擎会遍历整张表把每一行的字段值都取出来，返回给服务层，直接按行进行累加。</p>
</li>
<li><p>count (1)</p>
<p>InnoDB引擎遍历整张表, 但不取值 . 服务层对于返回的每一行 , 放一个数字 “ 1 “ 进去 , 直接按行进行累加 .</p>
</li>
<li><p>count( * )</p>
<p>InnoDB引擎并不会把全部字段取出来 , 而是专门做了优化 , 不取值 , 服务层直接按行进行累加 .</p>
</li>
</ul>
</blockquote>
<p>按照效率排序的话 , count(字段) &lt;  count(主键 id) &lt; count (1) ≈ count( <em> )  ,所以尽量使用 count(</em>)</p>
</li>
</ul>
<h3 id="update优化"><a href="#update优化" class="headerlink" title="update优化"></a>update优化</h3><blockquote>
<p>update  student set no = ‘2000100100’ where id = 1 ;</p>
<p>update student set no = ‘2000100105’ where name = ‘韦一笑’ ;</p>
</blockquote>
<ul>
<li>InnoDB的行锁是针对索引加的锁 , 不是针对记录加的锁 , 并且该索引不能失效 , 否则会从行锁升级为表锁 .</li>
</ul>
<hr>
<h2 id="视图-存储过程-触发器"><a href="#视图-存储过程-触发器" class="headerlink" title="视图 / 存储过程 / 触发器"></a>视图 / 存储过程 / 触发器</h2><h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><ul>
<li><p>介绍 : </p>
<p>视图(View) 是一种虚拟存在的表 . 视图中的数据并不在数据库中实际存在 , 行和列数据来自定义视图的查询中使用的表 , 并且是在使用视图是动态生成的.</p>
<p>通俗的讲 , 视图只保存了查询的SQL逻辑 , 不保存拆线呢结果 . 所以我们在创建视图的时候 , 主要的工作就落在这条SQL查询语句上.</p>
</li>
<li><p>创建</p>
<blockquote>
<p>CREATE [OR REPLACE] VIEW 视图名称 [(列名列表)]  AS SELECT语句 [WITH [CASCADED |  LOCAL] CHECK OPTION]</p>
</blockquote>
</li>
<li><p>查询</p>
<blockquote>
<p>查看创建视图语句 : SHOW CREATE VIEW 视图名称 ;</p>
<p>查看视图数据 : SELECT * FROM 视图名称…… ;</p>
</blockquote>
</li>
<li><p>修改</p>
<blockquote>
<p>方式一 : CREATE [OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH [CASCADED  |  LOCAL] CHECK OPTION] ;</p>
<p>方式二 : ALTER  VIEW  视图名称 [(列名列表) ] AS SELECT 语句 [WITH [CASCAD | LOCAL] CHECK OPTION] ;</p>
</blockquote>
</li>
<li><p>删除</p>
<blockquote>
<p>DROP VIEW [IF EXISTS] 视图名称  [视图名称] ;</p>
</blockquote>
</li>
<li><p>视图的检查选项</p>
<blockquote>
<p>当使用WITH CHRCK OPTION子句创建试图时 , MySQL会通过视图检查正在更改的每个行 , 例如 插入 , 更新 , 删除 , 以使其符合视图的定义 . MySQL允许基于另一个视图创建视图 , 他还会检查以来视图中的规则以保持一致性 . 为了确定检查的范围 ,  MySQL提供了两个选项 : CASCADED 和 LOCAL ,默认值为 CASCADED .</p>
</blockquote>
</li>
<li><p>视图的更新</p>
<ul>
<li><p>要使视图可以更新 , 视图中的行与基础表中的行之间必须存在一对一的关系 . 如果试图包含以下任何一项 , 则该视图不可更新 : </p>
<ol>
<li><p>聚合函数或窗口函数 ( SUM () , MIN () , MAX () , COUNT() 等)</p>
</li>
<li><p>DISTINCT</p>
</li>
<li>GROUP BY</li>
<li>HAVING</li>
<li>UNION 或者 UNION ALL</li>
</ol>
</li>
<li><p>作用</p>
<blockquote>
<ul>
<li><p>简单</p>
<p>视图不仅可以简化用户对数据的理解 , 也可以简化他们的操作 . 那些被经常使用的查询可以被定义为视图 , 从而使得用户不必为以后的操作每次指定全部的条件 .</p>
</li>
<li><p>安全</p>
<p>数据库可以授权 , 但不能授权到数据库特定行个特定的列上.通过视图用户只能查询和修改他们们所能见到的数据</p>
</li>
<li><p>数据独立</p>
<p>视图可以帮之用户屏蔽真实表结构变化带来的影响 .</p>
</li>
</ul>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><ul>
<li><p>介绍</p>
<p>存储过程是实现经过编译并储存在数据库中的一段SQL语句的集合 , 调用存储过程可以简化应用开发人员的很多工作 , 减少数据在数据库和应用服务器之间的传输 , 对于提高数据处理的效率是有好处的 . </p>
<p>储存过程思想很简单 , 就是数据库SQL语言层面的代码封装与重用 .</p>
</li>
<li><p>特点</p>
<p>封装 , 复用</p>
<p>可以接收参数 , 也可以返回数据</p>
<p>减少网络交互 , 效率提升</p>
</li>
<li><p>创建</p>
<blockquote>
<p>CREATE PROCEDURE 存储过程名称 ([参数列表])</p>
<p>BEGIN</p>
<p>​                —-SQL语句</p>
<p>END ;</p>
</blockquote>
</li>
<li><p>调用</p>
<blockquote>
<p>CALL 名称 ([参数]) ;</p>
</blockquote>
</li>
<li><p>查看</p>
<blockquote>
<p>查询指定数据库的存储过程及状态信息</p>
<p>SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_SCHEMA = ‘xxx’ ;</p>
<p>查询某个存储过程的定义</p>
<p>SHOW CREATE PROCEDURE 存储过程名称 ;</p>
</blockquote>
</li>
<li><p>删除</p>
<blockquote>
<p>DROP PROCEDURE [IF EXISTS] 存储过程名称 ; </p>
</blockquote>
</li>
<li><p>变量</p>
<ul>
<li><p>系统变量</p>
<p>是MySQL服务器提供 , 不是用户定义的 , 属于服务器层面 . 分为全局变量 (GLOBAL) , 会话变量 (SESSION) .</p>
<blockquote>
<ul>
<li><p>查看系统变量</p>
<p>查看所有系统变量</p>
<p>SHOW [SESSION | GLOBAL] VARIABLES;</p>
<p>可以通过LIKE模糊匹配的方式查找变量</p>
<p>SHOW [SESSION | GLOBAL] VARIABLES LIKE ‘……’ ;</p>
<p>查看指定变量的值</p>
<p>SELECT @@[SESSION | GLOBAL] 系统变量名 ;</p>
</li>
<li><p>设置系统变量</p>
<blockquote>
<p>SET [SESSION | GLOBAL] 系统变量名 = 值 ;</p>
<p>SET @@[SESSION | GLOBAL] 系统变量名 = 值 ;</p>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li><p>用户自定义变量</p>
<p>是用户根据需要自己定义的变量 , 用户变量不用提前声明 , 在用的时候直接用 “@变量名” 使用就可以 . 其作用域为当前连接.</p>
<blockquote>
<ul>
<li><p>赋值</p>
<blockquote>
<p>SET @var_name = expr [,@var_name = expr]… ;</p>
<p>SET @var_name := expr [,@var_name := expr]… ;</p>
<p>SELECT @var_name := expr [,@var_name := expr]… ;</p>
<p>SELECT  字段名 INTO @var_name FROM 表名 ;</p>
</blockquote>
</li>
<li><p>使用</p>
<blockquote>
<p>SELECT @var_name ;</p>
</blockquote>
</li>
<li><p>注意</p>
<blockquote>
<p>用户定义的变量无需对其进行声明或初始化 , 只不过获取到的值为NULL.</p>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li><p>局部变量</p>
<p>是跟据需要定义的在局部生效的变量 , 访问之前 , 需要DECLARE声明 . 可以用作储存过程内的局部变量和输入参数 , 局部变量的范围是在其内生命的BEGIN … END 块 .</p>
<blockquote>
<ul>
<li><p>声明</p>
<blockquote>
<p>DECLARE 变量名 变量类型 [DEFAULT…] ;</p>
</blockquote>
<p>变量类型就是数据库字段类型 : INT , BIGNT , CHAR  , VARCHAR  ,  DATE  ,  TIME等.</p>
</li>
</ul>
</blockquote>
</li>
<li><p>if</p>
<blockquote>
<ul>
<li><p>语法: </p>
<p>IF 条件1 THEN</p>
<p>​            …</p>
<p>ELSEIF 条件2 THEN        —-可选</p>
<p>​            …</p>
<p>ELSE                                —-可选</p>
<p>​            …</p>
<p>END IF;</p>
</li>
</ul>
</blockquote>
</li>
<li><p>参数</p>
<p>| 类型  |                     含义                      | 备注 |<br>| :—-: | :—————————————————————-: | :—: |<br>|  IN   |   该类参数作为输入 , 也就是需要调用时传入值   | 默认 |<br>|  OUT  | 该类参数作为输入 , 也就是该参数可以作为返回值 |      |<br>| INOUT |    即可以作为输入参数 , 也可以作为输出参数    |      |</p>
<p>用法</p>
<blockquote>
<p>CREATE PROCEDURE 存储过程名称 ([IN / OUT  /  INOUT  参数名  参数类型])</p>
<p>BEGIN</p>
<p>​            —-SQL语句</p>
<p>END ;</p>
</blockquote>
</li>
<li><p>case</p>
<blockquote>
<ul>
<li><p>语法一 </p>
<p>CASE case_value</p>
<p>​            WHEN when_value1 THEN statement_list1</p>
<p>​            [WHEN when_value2 THEN statement_list2]…</p>
<p>​            [ELSE statement_list]</p>
<p>END CASE ;</p>
</li>
<li><p>语法二</p>
<p>CASE</p>
<p>​        WHEN search_condition1 THEN statement_list1</p>
<p>​        [WHEN search_condition2 THEN statement_list2]…</p>
<p>​        [ELSE statement_list]</p>
<p>END CASE ;</p>
</li>
</ul>
</blockquote>
</li>
<li><p>while</p>
<p>while 循环是有条件的循环控制语句 . 满足条件后 , 再执行循环体中的 SQL 语句 , 具体语法为 :</p>
<blockquote>
<h1 id="先判定条件-如果条件为true-则执行逻辑-否则-不执行逻辑"><a href="#先判定条件-如果条件为true-则执行逻辑-否则-不执行逻辑" class="headerlink" title="先判定条件  , 如果条件为true , 则执行逻辑 , 否则 , 不执行逻辑"></a>先判定条件  , 如果条件为true , 则执行逻辑 , 否则 , 不执行逻辑</h1><p>WHILE 条件 DO</p>
<p>​            SQL 逻辑…</p>
<p>END WHILE ;</p>
</blockquote>
</li>
<li><p>repeat </p>
<p>repeat是有条件的循环控制语句 , 当满足条件的时候退出循环 . 具体语法为:</p>
<blockquote>
<h1 id="先执行一次逻辑-然后判定逻辑是否满足-如果满足-则退出-如果不满足-则继续下一次循环"><a href="#先执行一次逻辑-然后判定逻辑是否满足-如果满足-则退出-如果不满足-则继续下一次循环" class="headerlink" title="先执行一次逻辑 , 然后判定逻辑是否满足 , 如果满足 , 则退出 , 如果不满足 , 则继续下一次循环"></a>先执行一次逻辑 , 然后判定逻辑是否满足 , 如果满足 , 则退出 , 如果不满足 , 则继续下一次循环</h1><p>REPRAT </p>
<p>​        SQL逻辑…</p>
<p>​        UNTIL 条件</p>
<p>END REPEAT ;</p>
</blockquote>
</li>
<li><p>loop</p>
<p>loop实现简单的循环, 如果不在SQL逻辑中增加推出循环的条件 , 可以采用其来实现简单的死循环 . LOOP可以配合以下两个语句使用:</p>
<blockquote>
<p>LEAVE : 配合循环使用, 退出循环</p>
<p>ITERATE : 必须用在循环中 , 作用是跳过当前循环剩下的语句 , 直接进入下一次循环.</p>
<p> [begin_label : ] LOOP</p>
<p> ​            SQL逻辑…</p>
<p> END LOOP [end_label] ;</p>
<p>LEAVE lable; —-退出指定标记的循环体</p>
<p>ITERTE lable; —-直接进入下一次循环</p>
</blockquote>
</li>
<li><p>游标</p>
<p>游标 (CURSOR) 是用来存储查询结果集的数据类型  , 在存储过程和函数中可以使用游标对结果集进行循环的处理 . 游标的使用包括游标的声明 , OPEN , FETCH 和 CLOSE , 其语法分别如下 :</p>
<blockquote>
<ul>
<li><p>声明游标</p>
<p>DECLARE 游标名称 CURSOR FOR 查询语句 ;</p>
</li>
<li><p>打开游标</p>
<p>OPEN 游标名称 ;</p>
</li>
<li><p>获取游标记录</p>
<p>FETCH 游标名称 INTO 变量 [, 变量] ;</p>
</li>
<li><p>关闭游标</p>
<p>CLOSE 游标名称 ;</p>
</li>
</ul>
</blockquote>
</li>
<li><p>条件处理程序</p>
<p>条件处理程序 (Handler) 可以用来定义在流程控制结构执行过程中遇到问题时相应的处理步骤 . 具体语法为:</p>
<blockquote>
<p>DECLARE  handler_actionHANDLER FOR condition_value [, condition_value] … statement ;</p>
<p>handler_action</p>
<p>​        CONTINUE : 继续执行当前程序</p>
<p>​        EXIT : 终止执行当前程序</p>
<p>condition_value</p>
<p>​        SQLSTATE sqlstate_value : 状态码, 如02000</p>
<p>​        SQLWARNING : 所有以01开头的SQLSTATE代码的简写</p>
<p>​        NOT FOUND: 所有以02开头的SQLSTATE代码的简写</p>
<p>​        SQLEXCEPTION : 所有没有别SQLWARNING 或 NOT FOUND 捕获的SQLSTATE代码的简写</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h3><p>存储函数是有返回值的存储过程 , 存储函数的参数只能是IN类型的 . 具体语法如下 :</p>
<blockquote>
<p>CREATE FUNICTION 存储函数名称 ([参数列表])</p>
<p>RETURNS type [characteristic …]</p>
<p>BEGIN</p>
<p>​        —SQL语句</p>
<p>​        RETURN…;</p>
<p>END;</p>
<p>characteristic说明 : </p>
<ul>
<li>DETERMINISTIC : 相同的输出参数总是产生相同的结果</li>
<li>NO SQL : 不包含SQL语句 .</li>
<li>READS SQL DATA : 包含读取数据的语句 , 但不包含写入数据的语句 .</li>
</ul>
</blockquote>
<h3 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h3><ul>
<li><p>介绍</p>
<p>触发器时与表有关的数据库对象 , 指在insert / update / delete 之前或之后 , 出发并执行触发器中定义的SQL语句集合 . 触发器的这种特性可以协助应用在数据库端确保数据的完整性 , 日志记录 , 数据校验等操作 . </p>
<p>使用别名OLD 和 NEW 来引用触发器中发生变化的记录内容 , 这与其它的数据库是相似的 . 现在触发器还只支持行级触发 , 不支持语句级触发 .</p>
<p>|   触发器类型   |                       NEW 和 OLD                       |<br>| :——————: | :——————————————————————————: |<br>| INSERT型触发器 |             NEW 表示将要或者已经新增的数据             |<br>| UPDATE型触发器 | OLD表示修改之前的数据 , NEW 表示将要或已经修改后的数据 |<br>| DELETE型触发器 |             OLD 表示将要或者已经删除的数据             |</p>
</li>
<li><p>语法</p>
<blockquote>
<ul>
<li><p>创建</p>
<p>CREATE TRIGGER trigger_name</p>
<p>BEFORE/AFTER INSERT/UPDATE/DELETE</p>
<p>ON tbl_name FOR EACH ROW  —行级触发器</p>
<p>BEGIN</p>
<p>​        tigger_shmt;</p>
<p>END ;</p>
</li>
</ul>
<hr>
<ul>
<li><p>查看</p>
<p>SHOW TRIGGERS ;</p>
</li>
</ul>
<hr>
<ul>
<li><p>删除</p>
<p>DROP TRIGGER [schema_name.]trigger_name ; —-如果没有指定schema_name , 默认为当前数据库</p>
</li>
</ul>
</blockquote>
</li>
</ul>
<hr>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul>
<li><p>介绍</p>
<p>锁是计算机协调多个进程或线程并发访问某一资源的机制  . 在数据库中 , 除传统的计算资源 (CPU , RAM , I / O)的征用以外 , 数据也是一种供许多用户共享的资源 . 如何保证数据并发访问的一致性 , 有效性是所有数据库必须解决的一个问题 ,所冲突也是影响数据库并发访问性能的一个重要因素 . 从这个角度来说 , 锁对数据库而言显得尤其重要 , 也更加复杂 .</p>
</li>
<li><p>分类</p>
<p>M有SQL中的锁 , 按照锁的力度分  , 分为以下三类 :</p>
<ol>
<li>全局锁 : 锁定数据库中的所有表 .</li>
<li>表级锁 : 每次操作锁住整张表 .</li>
<li>行级锁 : 每次操作锁住对应的行数据 .</li>
</ol>
</li>
</ul>
<h3 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h3><ul>
<li><p>介绍<br>全局锁就是对整个数据库实例加锁 , 加锁后整个实例就处于只读状态, 后续的DML的语句 , DLL语句 , 已经更新操作的事务提交语句都将被堵塞 .</p>
<p>其典型的使用场景是做全库的逻辑备份 , 对所有的表进行锁定 , 从而获取一致性视图 , 保证数据的完整性 .</p>
</li>
<li><p>特点</p>
<p>数据库中加全局锁 , 是一个比较重要的操作 , 存在以下问题 :</p>
<ol>
<li>如果在主库上备份 , 那么在备份期间都不能执行更新 , 业务基本上就得停摆 .</li>
<li>如果在从库上备份 , 那么在备份期间从库不能执行主库同步过来的二进制日志 (binlog) , 会导致主从延迟 .</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><p>在InnoDB引擎中 , 我们可以在备份时加上参数 —single-transaction参数来完成不加锁的一致性数据备份</p>
<p>mysqldump —single-transaction -u root - p 123456 要备份的数据库 &gt; 备份名</p>
</li>
</ul>
</blockquote>
<h3 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h3><ul>
<li><p>介绍</p>
<p>表级锁 , 每次操作锁住整张表 . 锁定力度大 , 发生冲突的概率最高 , 并发性最低 . 应用在MyISAM , InnoDB , BDB 等存储引擎中 .</p>
</li>
</ul>
<p>  对于表级锁 , 主要分为以下三类 :</p>
<ol>
<li>表锁</li>
<li>元数据锁 (meta data lock , MDL)</li>
<li>意向锁</li>
</ol>
<ul>
<li><p>表锁</p>
<p>对于表锁 ,分为两类:</p>
<ol>
<li>表共享读锁 (read lock)</li>
<li>表独占写锁 (write lock)</li>
</ol>
</li>
</ul>
<p>  语法</p>
<ol>
<li>加锁 : lock tables 表名… read /write .</li>
<li>释放锁 : unlock tables / 客户端断开连接 .</li>
</ol>
<ul>
<li><p>元数据锁 (meta data lock , MDL)</p>
<p>MDL加锁过程是系统自动控制 , 无需显示使用 , 在访问一张表的同时会自动加上 . MDL锁主要作用是维护表元数据的数据一致性</p>
</li>
<li><p>意向锁</p>
<p>为了避免DML在执行时 , 加的行锁与表锁的冲突 , 在InnoDB引擎中引入了意向锁 , 使得表锁不用检查每行数据是否加锁 , 使用意向锁来减少表锁的检查 . </p>
</li>
</ul>
<ol>
<li>意向共享锁 (IS) : 与表锁共享锁 ( read ) 兼容 , 与表锁排他锁 ( write ) 互斥</li>
<li>意向排他锁 (IX) : 与表锁共享锁 ( read ) 及排他锁( write ) 都互斥 . 意向锁之间不会互斥 .</li>
</ol>
<p>  可以通过以下SQL , 查看意向锁及行锁的加锁情况: </p>
<blockquote>
<p>select object_schema , object_name , index_name , lock_type , lock_mode , lock_data from performance_schema.data_locks ;</p>
</blockquote>
<h3 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h3><ul>
<li><p>介绍</p>
<p>行级锁 , 每次操作所住对应的行数据 . 锁定粒度最小 , 发生锁冲突的改率最低 ,并发度最高 , 应用在InnoDB存储引擎中 .</p>
<p>InnoDB的数据是基于索引组织的 , 行锁是通过对索引上的索引项加锁来实现的 , 而不是对记录加的锁 . 对于行级锁 , 主要分为三类 :</p>
<blockquote>
<ol>
<li>行锁 (Record Lock) :锁定单个行记录的锁 , 防止其他事务对此进行update和delete . 在RC , RR 隔离级别下都支持 .</li>
<li>间隙锁 (Gap Lock) : 锁定索引记录间隙 ( 不含该记录 ) , 确保索引记录间隙不变 , 防止其他食物在这个间隙进行insert , 产生幻读 . 在RR隔离级别下都支持 .</li>
<li>临键锁 (Next-Key Lock) : 行锁和间隙锁组合 , 同时锁住数据 , 并锁住数据前面的间隙Gap . 在RR隔离级别下支持 .</li>
</ol>
</blockquote>
</li>
<li><p>行锁</p>
<p>InnoDB实现了以下两种类型的行锁 : </p>
<ol>
<li>共享锁 (S) : 允许一个事务去读一行 , 组织其他事务获得相同数据集的排他锁 .</li>
<li>排他锁 (X) : 允许获取排他锁的事务更新数据 , 阻止其他事务获得相同数据集的共享锁和排他锁 .</li>
</ol>
<p>| 当前锁类型 \ 请求锁类型 | S (共享锁) | X (排他锁) |<br>| :——————————-: | :————: | :————: |<br>|        S(共享锁)        |    兼容    |    冲突    |<br>|        X(排他锁)        |    冲突    |    冲突    |</p>
<p>|             SQL             |  行锁类型  |                   说明                   |<br>| :————————————-: | :————: | :———————————————————: |<br>|          INSERT…          |   排他锁   |                 自动加锁                 |<br>|          UPDATE…          |   排他锁   |                 自动加锁                 |<br>|          DELETE…          |   排他锁   |                 自动加锁                 |<br>|        SELECT(正常)         | 不加任何锁 |                                          |<br>| SELECT…LOCK IN SHARE MODE |   共享锁   | 需要手动在SELECT之后加LOCK IN SHARE MODE |<br>|     SELECT..FOR UPDATE      |   排他锁   |     需要手动在SELECT之后加FOR UPDATE     |</p>
<ul>
<li>行锁演示</li>
</ul>
<blockquote>
<p>默认情况下 , InnoDB在 REPEATABLE READ 事务隔离级别运行 , InnoDB使用next-key 锁进行搜索和索引扫描 , 防止幻读</p>
<ol>
<li>针对唯一索引进行检索时 , 对已存在的记录进行等值匹配时 , 将会自动优化为行锁</li>
<li>InnoDB的行锁是针对于索引加的锁 , 不通过索引条件检索数据 , 那么InnoDB将对表中的所有记录加锁 , 此时 就会升级为表锁</li>
</ol>
</blockquote>
<p>可以通过一下SQL ,查看意向锁及行锁的加锁情况</p>
<p>select object_schema,object_name,index_name,lock_type,lock_mode,lock_data from perfomance_schema.data_locks;</p>
</li>
<li><p>间隙锁 / 临键锁-演示</p>
<p>默认情况下 , InnoDB在 REPEATABLE READ 事务隔离级别运行 , InnoDB使用next-key锁进行搜索和索引扫描 , 防止幻读 .</p>
<ol>
<li>索引上的等值查询 (唯一索引) , 给不存在的记录枷锁时 , 优化为间隙锁 .</li>
<li>索引上的等值查询 (普通索引) , 向右遍历时最后一个值不满足查询需求时 , nex-key lock 退化为间隙锁 .</li>
<li>索引上的范围查询 (唯一索引) — 会访问到不满足条件的第一个值为止 .</li>
</ol>
<blockquote>
<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>间隙锁唯一目的是防止其他事务插入间隙 . 间隙锁可以共存 , 一个事务采用的间隙锁不会阻止另一个事务在同一个间隙锁上采用间隙锁</p>
</blockquote>
</li>
</ul>
<hr>
<h2 id="InnoDB引擎"><a href="#InnoDB引擎" class="headerlink" title="InnoDB引擎"></a>InnoDB引擎</h2><h3 id="逻辑存储结构"><a href="#逻辑存储结构" class="headerlink" title="逻辑存储结构"></a>逻辑存储结构</h3><ul>
<li>表空间 (ibd文件)，一个mysql实例可以对应多个表空间，用于存储记录、索引等数据.</li>
<li>段，分为数据段(Leafnode segment)、索引段(Non-leaf node segment)、回滚段(Rolback segment)，InnoDB是索引组织表，数据段就是B+树的叶子节点，索引段即为B+树的非叶子节点。段用来管理多个Extent(区)。</li>
<li>区，表空间的单元结构，每个区的大小为1M。默认情况下，InnoDB存储引擎页大小为16K，即一个区中一共有64个连续的页。</li>
<li>页，是lnnoDB 存储引擎磁盘管理的最小单元，每个页的大小默认为 16KB。为了保证页的连续性，innoDB 存储引警每次从磁盘申请 4-5个区。</li>
<li>行，InnoDB 存储引擎数据是按行进行存放的。</li>
<li>Trx id: 每次对某条记录进行改动时，都会把对应的事务id赋值给trx id隐藏列。<br>Rol pointer: 每次对某条引记录进行改动时，都会把目的版本写入到undo日志中，然后这个隐藏列就相当于一个指针，可以通过它来找到该记录修改前的信息，</li>
</ul>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><p>MySOL5.5 版本开始，默认使用lnnoDB存储引肇，它擅长事务处理，具有崩溃恢复特性，在日常开发中使用非常广泛。下面是InnoDB架构图，左侧为内存结构，右侧为磁盘结构。</p>
<ul>
<li><p>内存架构</p>
<blockquote>
<ul>
<li><p>Buffer Pool: 缓冲池是主内存中的一个区域，里面可以缓存磁盘上经常操作的真实数据，在执行增删改查操作时，先操作缓冲池中的数据(若缓冲池没有数据，则从磁盘加载并缓存)，然后再以一定频率刷新到磁盘，从而减少磁盘10，加快处理速度</p>
</li>
<li><p>缓冲池以Page页为单位，底层采用链表数据结构管理Page。根据状态，将Page分为三种类型</p>
<ul>
<li>free page:空闲page，未被使用。</li>
<li>clean page:被使用page，数据没有被修改过</li>
<li>dirty page: 脏页，被使用page，数据被修改过，也中数据与磁盘的数据产生了不一致</li>
</ul>
</li>
<li><p>Change Buffer: 更改缓冲区(针对于非唯一二级索引页)，在执行DML语句时，如果这些数据Page没有在Buffer Pool中，不会直接操作磁盘，而会将数据变更存在更改缓冲区Change Buffer 中，在未来数据被读取时，再将数据合并恢复到Buffer Pool中，再将合并后的数据刷新到磁盘中。</p>
</li>
<li><p>Change Buffer的意义是什么?<br>与聚集索引不同，二级索引通常是非唯一的，并且以相对随机的顺序插入二级索引。同样，删除和更新可能会影响索引树中不相邻的二级索引页，如果每一次都操作磁盘，会造成大量的磁盘10。有了ChangeBuffer之后，我们可以在缓冲池中进行合并处理，减少磁盘IO。</p>
</li>
<li><p>Adaptive Hash lndex: 自适应hash索引，用于优化对Buffer Pool数据的查询。InnoDB存储引警会监控对表上各索引页的查询，如果观察到hash索引可以提升速度，则建立hash索引，称之为自适应hash索引。</p>
</li>
<li><p>自适应哈希索引，无需人工干预，是系统根据情况自动完成。</p>
</li>
</ul>
<p>参数:adaptive hash index</p>
<ul>
<li>Log Buffer: 日志缓冲区，用来保存要写入到磁盘中的log日志数据 (redo log、undo log)，默认大小为 16MB，日志缓冲区的日志会定期刷新到磁盘中。如果需要更新、插入或删除许多行的事务，增加日志缓冲区的大小可以节省磁盘 1/0<br>参数:<br>innodb log_buffer_size: 缓冲区大小<br>innodb flush log_at trx commit: 日志刷新到磁盘时机</li>
</ul>
</blockquote>
</li>
</ul>
<ul>
<li><p>磁盘结构</p>
<blockquote>
<ul>
<li><p>System Tablespace: 系统表空间是更改缓冲区的存储区域。如果表是在系统表空间而不是每个表文件或通用表空间中创建的，它也可能包含表和索引数据。(在MySQL5.x版本中还包含lnnoDB数据字典、undolog等)<br>参数:innodb data file_path</p>
</li>
<li><p>File-Per-Table Tablespaces:每个表的文件表空间包含单个InnoDB表的数据和索引，并存储在文件系统上的单个数据文件中<br>参数:innodb file per_table</p>
</li>
<li><p>GeneralTablespaces: 通用表空间，需要通过CREATE TABLESPACE 语法创建通用表空间，在创建表时，可以指定该表空间。</p>
<blockquote>
<p>CREATE TABLESPACE XXXX ADD</p>
<p>DATAFILE ‘file_name’</p>
<p>ENGINE =engine_name;</p>
</blockquote>
</li>
<li><p>Doublewrite Buffer Files: 双写缓冲区，innoDB引警将数据页从Buffer Pool刷新到磁盘前，先将数据页写入双写缓冲区文件中，便于系统异常时恢复数据.</p>
</li>
<li><p>Redo Log: 重做日志，是用来实现事务的持久性。该日志文件由两部分组成:重做日志缓冲(redo log buffer)以及重做日志文件(redo log),前者是在内存中，后者在磁盘中。当事务提交之后会把所有修改信息都会存到该日志中,用于在刷新脏页到磁盘时,发生错误时,进行数据恢复使用。</p>
</li>
</ul>
</blockquote>
</li>
<li><p>后台线程</p>
<blockquote>
<ul>
<li><p>Master Thread<br>核心后台线程，负责调度其他线程，还负责将缓冲池中的数据异步刷新到磁盘中,保持数据的一致性还包括脏页的刷新、合并插入缓存、undo页的回收。</p>
</li>
<li><p>I0 Thread<br>在InnoDB存储引擎中大量使用了AIO来处理IO请求,这样可以极大地提高数据库的性能，而I0Thread主要负责这些IO请求的回调。</p>
<p>|       线程类型       | 默认个数 |             职责             |<br>| :—————————: | :———: | :—————————————: |<br>|     Read thread      |    4     |          负责读操作          |<br>|     Write thread     |    4     |          负责写操作          |<br>|      Log thread      |    1     |  负责将日志缓冲区刷新到磁盘  |<br>| Insert buffer thread |    1     | 负责将写缓冲区内容刷新到磁盘 |</p>
</li>
<li><p>Purge Thread</p>
<p>主要用来回收事务已经提交了的undo log , 在事务提交之后 , undo log可能不用了 , 就用它来回收 .</p>
</li>
<li><p>Page Cleaner Thread</p>
<p>协助 Master Thread 刷新脏页到磁盘的线程 , 它可以减轻Master Thread的工作压力 , 减少阻塞 .</p>
</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="事务原理"><a href="#事务原理" class="headerlink" title="事务原理"></a>事务原理</h3><ul>
<li><p>事务</p>
<p>事务是一组操作的集合 , 他是一个不可分割的工作单位 , 事务会把所有的操作作为一个整体一起像系统提交或撤销操作请求 , 即这些操作要么同时成功 , 要么同时失败 . </p>
</li>
<li><p>特性</p>
<p>原子性 ( Atomicity ) : 事务时不可分割的最小操作单元 , 要么全部成功 , 要么全部失败 .</p>
<p>一致性  (Consistency) : 事务完成时 , 必须使用所有i的数据都保持一致状态 .</p>
<p>隔离性 ( Isolation ) : 数据库系统提供的隔离机制 , 保证事务在不受外部并发操作影响的独立环境下运行 .</p>
<p>持久性 ( Durability ) : 事务一旦提交或回滚, 他对数据库中的数据的改变就是永久的 .</p>
</li>
<li><p>原子性</p>
<blockquote>
<ul>
<li><p>redo log</p>
<p>重做日志 , 记录的是事务提交时的数据页的物理修改 , 是用来实现事务的持久性 .</p>
<p>该日志文件由两部分组成 : 重做日志缓冲 ( redo log buffer ) 以及重做日志文件 ( redo log file ) , 前者是在内存中 , 后者在磁盘中 . 当事务提交之后会把所有的修改信息都存到该日志文件中 , 用于再刷新脏页到磁盘 , 发生错误时 , 进行数据恢复使用 .</p>
</li>
<li><p>undo log</p>
<p>回滚日志 , 用于记录数据被修改前的信息 , 作用包含两个 : 提供回滚 和 MVCC (多版本并发控制) .</p>
<p>updo log 和 redo log记录物理日志不一样 , 它是逻辑日志 . 可以认为当delete一条记录时 , undo log 中会记录一条对应的insert记录 ，反之亦然 , 当update一条记录时，它记录一条对应相反的update记录。当执行rollback时，就可以从undolog中的逻辑记录读取到相应的内容并进行回滚。</p>
<p>Undo log销毁: undo log在事务执行时产生，事务提交时，并不会立即删除undo log，因为这些日志可能还用于MVCC。</p>
<p>Undo log存储:undo log采用段的方式进行管理和记录，存放在前面介绍的 rolback segment 回滚段中，内部包含1024个undo </p>
<p>log segment.</p>
</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h3><ul>
<li><p>基本概念</p>
<ul>
<li><p>当前读</p>
<p>读取的是记录的最新版本 , 读取时要保证其他并发事务不能修改当前记录 , 会对读取的记录进行加锁 . 对于我们日常的操作 , 如:</p>
<p>select…lock in share mode(共享锁) , select … for update , insert , delete(排他锁)都是一种当前读 .</p>
</li>
<li><p>快照读</p>
<p>简单的select ( 不加锁 ) 就是快照读 , 快照读 , 读取的是记录数据的可见版本 , 有可能是历史数据 , 不加锁 , 是非阻塞读 .</p>
<ul>
<li>Read Committed : 每次select , 都生成一个快照读 . </li>
<li>Repeatable Read : 开启事务后第一个select语句才是快照读的地方 .</li>
<li>Serializable : 快照读会退化为当前读</li>
</ul>
</li>
</ul>
</li>
<li><p>实现原理</p>
<ul>
<li><p>记录中的隐藏字段</p>
<p>|  隐藏字段   |                             含义                             |<br>| :————-: | :—————————————————————————————: |<br>|  DB_TRX_ID  | 最近修改事务ID , 记录插入这条记录或最后一次修改该记录的事务ID . |<br>| DB_ROLL_PTR | 回滚指针,指向这条记录的上一个版本 , 用于配合undo log, 指向上一个版本 |<br>|  DB_ROW_ID  |    隐藏主键, 如果表结构没有指定主键 , 将会生成该隐藏字段     |</p>
</li>
<li><p>undo log</p>
<p>回滚日志，在insert、update、delete的时候产生的便于数据回滚的日志。</p>
<p>当insert的时候，产生的undo log日志只在回滚时需要，在事务提交后，可被立即删除。</p>
<p>而update、delete的时候，产生的undo log日志不仅在回滚时需要，在快照读时也需要，不会立即被删除。</p>
<blockquote>
<p>不同事务或相同事务对同一条记录进行修改 , 会导致该记录的undo log生成一条记录版本链表 , 链表的头部是最新的旧记录 ,  链表尾部是最早的旧记录 .</p>
</blockquote>
</li>
<li><p>readview</p>
<p>ReadView (读视图) 是 快照读 SQL 执行时MVCC提取数据的依据 , 记录并维护系统当前活跃的事务 (未提交的) id .</p>
<p>ReadView中包含了四个核心字段 :</p>
<p>|      字段      |                         含义                          |<br>| :——————: | :—————————————————————————-: |<br>|     m_ids      |                 当前活跃的事务ID集合                  |<br>|   min_trx_id   |                    最小活跃事务ID                     |<br>|   max_trx_id   | 预分配事务ID , 当前最大事务ID + 1(因为事务ID是自增的) |<br>| creator_trx_id |                ReadView创建者的事务ID                 |</p>
<blockquote>
<p>不同的隔离级别 , 生成ReadView的时机不同 :</p>
<ul>
<li>READ COMMITTED : 在事务中每一次执行快照读时生成ReadView .</li>
<li>REPEATABLE READ : 仅在事务中第一次执行快照读时生成ReadView , 后续复用该ReadView</li>
</ul>
<p>RC隔离级别下 , 在事务中每一次执行快照读时生成ReadView</p>
<p>RR隔离级别下 , 仅在事务中第一次执行快照读时 , 生成ReadView , 后续复用该ReadView.</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="MySQL管理"><a href="#MySQL管理" class="headerlink" title="MySQL管理"></a>MySQL管理</h2><h3 id="系统数据库"><a href="#系统数据库" class="headerlink" title="系统数据库"></a>系统数据库</h3><p>MySQL数据库安装完成后 , 自带了以下四个数据库 , 具体作用如下 : </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">数据库</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">MySQL</td>
<td style="text-align:center">存储MySQL服务器正常运行所需要的各种信息 (时区、主从、用户、权限等)</td>
</tr>
<tr>
<td style="text-align:center">information_schema</td>
<td style="text-align:center">提供了访问数据库元数据的各种表和视图，包含数据库、表、字段类型及访问权限等</td>
</tr>
<tr>
<td style="text-align:center">performance_schema</td>
<td style="text-align:center">为MySQL服务器运行时状态提供了一个底层监控功能，主要用于收集数据库服务器性能参数</td>
</tr>
<tr>
<td style="text-align:center">sys</td>
<td style="text-align:center">包含了一系列方便DBA和开发人员利用 performance schema 性能数据库进行性能调优和诊断的视图</td>
</tr>
</tbody>
</table>
</div>
<h3 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h3><ul>
<li><p>MySQL </p>
<p>该MySQL不是指MySQL服务 , 而是指MySQL的客户端工具.</p>
<blockquote>
<p>语法 :</p>
<p>​    MySQL [OPTIONS] [DATABASE]</p>
<p>选项 : </p>
<p>​        -u, —user = name                   #指定用户名</p>
<p>​        -p, —password[= name]         #指定密码</p>
<p>​        -h, —host = name                   #指定服务器IP或域名</p>
<p>​        -p, —port = port                      #指定连接端口</p>
<p>​        -e, —execute = name             #执行SQL语句并退出</p>
</blockquote>
<p>-e选项可以在MySQL客户端执行SQL语句 , 而不用连接到MySQL数据库在执行 , 对于一些批量处理的脚本 , 这种方式尤其方便</p>
<blockquote>
<ul>
<li><p>示例</p>
<p>mysql -u root -p 123456 db01 -e “select * from stu” ;</p>
</li>
</ul>
</blockquote>
</li>
<li><p>MySQLadmin</p>
<p>MySQLadmin是一个执行管理操作的客户端程序 . 可以用它来检查服务器的配置和当前的状态 , 创建并删除数据库等 .</p>
<blockquote>
<p>通过帮助文档查看选项</p>
<p>​        MySQLadmin —help</p>
</blockquote>
</li>
<li><p>MySQLbinlog</p>
<p>由于服务器生成的二进制日志文件以二进制格式保存 , 所以如果想要检查这些文本格式 , 就会使用到MySQLbinlog日志管理工具</p>
<blockquote>
<p>语法 :</p>
<p>​    MySQLbinlog [options] log-files1 log-files2…</p>
<p>选项 :<br>   -d , —database = name                                                 指定数据库名称, 只列出指定的数据库相关操作</p>
<p>​    -o , —offset = #                                                              忽略掉日志中的前n行命令</p>
<p>​    -r , -result-file = name                                                   将输出的文本格式日志输出到指定文件</p>
<p>​    -s , —short-form                                                            显示简单格式 , 省略到一些信息</p>
<p>​    —start-datatime = date1 —stop-datetime = date2         指定日期间隔内的所有日志</p>
<p>​    —start-position=pos1 —stop-position = pos2                指定位置间隔内的所有日志</p>
</blockquote>
</li>
<li><p>MySQLshow</p>
<p>MySQLshow客户端对象查找工具 , 用来很快地查找存在哪些数据库 , 数据库中的表 , 表中的列或者索引 .</p>
<blockquote>
<p>mysqlshow [options] [db_name [table_name [col_name]ll<br>选项 :</p>
<p>​            -count    显示数据库及表的统计信息 (数据库，表 均可以不指定)</p>
<p>​            -i            显示指定数据库或者指定表的状态信息    </p>
<p>示例:</p>
<pre><code>#查询每个数据库的表的数量及表中记录的数量
</code></pre><ul>
<li>​    mysqlshow -uroot -p2143 —count</li>
</ul>
<p>​    #查询test库中每个表中的字段书，及行数</p>
<ul>
<li>​    mysglshow -uroot -p2143 test —count</li>
</ul>
<p>​    #查询test库中book表的详细情况</p>
<ul>
<li>​    mysqlshow -uroot -p2143 test book —count</li>
</ul>
</blockquote>
</li>
<li><p>mysqldump</p>
<p>mysqldump 客户端工具用来备份数据库或在不同数据库之间进行数据迁移。备份内容包含创建表，及插入表的SQL语句。</p>
<blockquote>
<p>语法:</p>
<pre><code>   mysaldump [options] db_name (tables)
   mysaldump [options] --database/-B db1 [db2 db3....]
   mysaldump [options] --all-databases/-A
</code></pre><p>连接选项:</p>
<pre><code>   -U,--user=name                        指定用户名
   -p, --password(=name]             指定密码
   -h, --host=name                        指定服务器ip或域名
   -P,--port-#                                 指定连接端口
</code></pre><p>输出选项:</p>
<pre><code>   -add-drop-database                 在每个数据库创建语句前加上 drop database 语句
   --add-drop-table                       在每个表创建语句前加上 drop table 语句，默认开启; 不开启(--skip-add-drop-table)
   -n, --no-create-db                     不包含数据库的创建语句
   -t, --no-create-info                    不包含数据表的创建语句
   -d --no-data                              不包含数据
   -T.--tab=name                          自动生成两个文件:一个.sgl文件，创建表结构的语句;一个.txt文件，数据文件
</code></pre></blockquote>
</li>
<li><p>mysqlimport / source</p>
<p>mtsqlimport 是客户端数据导入工具 , 用来导入mysqldump 加 -T 参数后导出的文本文件 .</p>
<blockquote>
<p>语法 :</p>
<p>​                mysqlimport [options] db_name textfile1 [ textfile2 ]</p>
<p>示例 :</p>
<p>​                mysqlimport -uroot  -p2143 test/tmp/city.txt</p>
</blockquote>
<p>如果需要导入sql文件 , 可以使用 mtsql 中的 source 指令 :</p>
<blockquote>
<p>语法 : </p>
<p>​                source / root / xxxxx.sql</p>
</blockquote>
</li>
</ul>
<hr>
<h1 id="MySQL运维"><a href="#MySQL运维" class="headerlink" title="MySQL运维"></a>MySQL运维</h1><hr>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><h3 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h3><p>错误日志时MySQL中最重要的日志之一 , 它记录了当mysqld 启动和停止时 , 以及服务器在运行过程中发生任何严重错误时的相关信息.当数据库出现任何故障导致无法整成使用时 , 建议首先查看此日志 .</p>
<p>该日志是默认开启的 , 存放目录 /var/log/ , 默认的日志文件名为 mysqld.log . 查看日志位置 :</p>
<blockquote>
<p>show variables like ‘%log_error%’</p>
</blockquote>
<hr>
<h3 id="二进制日志"><a href="#二进制日志" class="headerlink" title="二进制日志"></a>二进制日志</h3><ul>
<li><p>介绍</p>
<p>二进制日志 (BINLOG) 记录了所有的DDL (数据定义语言) 语句和DML (数据操纵语言) 语句 , 但不包括数据查询 (SELECT , SHOW)语句 .</p>
<p>作用 : </p>
<ol>
<li><p>灾难时的数据恢复;</p>
</li>
<li><p>MySQL的主从复制 在MySQL8版本中 , 默认二进制日志是开启着的 , 涉及到的参数如下 :</p>
<blockquote>
<p>show variables like ‘ %log_bin%’</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<ul>
<li><p>日志格式</p>
<p>MySQL服务器中提供了多种格式来记录二进制日志，具体格式及特点如下:</p>
<p>| 日志格式  |                             含义                             |<br>| :———-: | :—————————————————————————————: |<br>| STATEMENT | 基于SQL语句的日志记录，记录的是SQL语句，对数据进行修改的SQL都会记录在日志文件中。 |<br>|    ROW    |      基于行的日志记录，记录的是每一行的数据变更。(默认)      |<br>|   MIXED   | 混合了STATEMENT和ROW两种格式，默认采用STATEMENT，在某些特殊情况下会自动切换为ROW进行记录. |</p>
<blockquote>
<p>shaw variables like ‘%binlog_formnat%’;</p>
</blockquote>
<p>由于日志是以二进制方式存储的 , 不能直接读取 , 需要通过二进制日志查询工具 mysqlbinlog 来查看 , 具体语法 :</p>
<blockquote>
<p>mysqlbinlog [参数选项] logfilename</p>
<p>参数选项:</p>
<p>​        -d           指定数据库名称 , 只列出指定的数据库相关操作 .</p>
<p>​        -o           忽略掉日志中的前n行命令 .</p>
<p>​        -v           将行事件 (数据变更) 重构为SQL语句</p>
<p>​        -vv         将行事件 (数据变更) 重构为SQL语句 , 并输出注释信息</p>
</blockquote>
</li>
<li><p>日志删除</p>
<p>对于比较繁忙的业务系统 , 每天生成的binlog数据巨大 , 如果长时间不清除 , 将会占用大量的磁盘空间 . 可以通过以下几种方式清理日志 :</p>
<p>|                       指令                       |                             含义                             |<br>| :———————————————————————: | :—————————————————————————————: |<br>|                   reset master                   | 删除全部binlog日志 , 删除之后 , 日志编号 , 将从binlog.000001重新开始 |<br>|        purge master logs to ‘binlog.<strong><strong>‘        |                 删除*</strong></strong>编号之前的所有日志                  |<br>| purge master logs before ‘yyyy-mm-dd hh24:mi:ss’ |     删除日志为”yyyy-mm-dd hh24:mi:ss”之前产生的所有日志      |</p>
<p>也可以在mysql的配置文件中配置二进制的过期时间 , 设置了之后 , 二进制日志过期会自动删除 .</p>
<blockquote>
<p>show variables like ‘%binlog_expire_logs_seconds%’ ;</p>
</blockquote>
</li>
</ul>
<hr>
<h3 id="查询日志"><a href="#查询日志" class="headerlink" title="查询日志"></a>查询日志</h3><p>查询日志中记录了客户端的所有操作语句 , 而二进制日志不包含查询数据的SQL语句 . 默认情况下 , 查询日志是未开启的 . 如果需要开启查询日志 , 可以设置以下配置</p>
<p>修改MySQL的配置文件 /etc/my.cnf 文件，添加如下内容:</p>
<blockquote>
<h1 id="该选项用来开启查询日志-，-可选值-0-或者1-0-代表关闭，-1代表开启-general-log-1"><a href="#该选项用来开启查询日志-，-可选值-0-或者1-0-代表关闭，-1代表开启-general-log-1" class="headerlink" title="该选项用来开启查询日志 ， 可选值 : 0 或者1;0 代表关闭， 1代表开启                                                                                  general_log=1"></a>该选项用来开启查询日志 ， 可选值 : 0 或者1;0 代表关闭， 1代表开启                                                                                  general_log=1</h1><h1 id="设置日志的文件名，如果没有指定，默认的文件名为-host-name-log-general-log-file-mysql-query-log"><a href="#设置日志的文件名，如果没有指定，默认的文件名为-host-name-log-general-log-file-mysql-query-log" class="headerlink" title="设置日志的文件名，如果没有指定，默认的文件名为 host name.log                                                           general_log_file=mysql_query.log"></a>设置日志的文件名，如果没有指定，默认的文件名为 host name.log                                                           general_log_file=mysql_query.log</h1></blockquote>
<hr>
<h3 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h3><p>慢查询日志记录了所有执行时间超过参数 long_query_time 设置值并且扫描记录数不小于 min_examined_row_limit的所有的SQL语句的日志，默认未开启。long_query_time 默认为 10 秒，最小为0，精度可以到微秒。</p>
<blockquote>
<h1 id="慢查询日志-slow-query-log-1"><a href="#慢查询日志-slow-query-log-1" class="headerlink" title="慢查询日志                                                                                                                                                                      slow_query_log=1"></a>慢查询日志                                                                                                                                                                      slow_query_log=1</h1><h1 id="执行时间参数-long-query-time-2"><a href="#执行时间参数-long-query-time-2" class="headerlink" title="执行时间参数                                                                                                                                                           long_query_time=2"></a>执行时间参数                                                                                                                                                           long_query_time=2</h1></blockquote>
<p>默认情况下，不会记录管理语句，也不会记录不使用索引进行查找的查询。可以使用log slow admin statements和更改此行为 log_queries not using indexes，如下所述</p>
<blockquote>
<h1 id="记录执行较慢的管理语句"><a href="#记录执行较慢的管理语句" class="headerlink" title="记录执行较慢的管理语句"></a>记录执行较慢的管理语句</h1><p>log slow admin statements =1</p>
<h1 id="记录执行较慢的未使用索引的语句"><a href="#记录执行较慢的未使用索引的语句" class="headerlink" title="记录执行较慢的未使用索引的语句"></a>记录执行较慢的未使用索引的语句</h1><p>log queries not using indexes = 1</p>
</blockquote>
<hr>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>主从复制是指将主数据库的DDL 和 DML 操作通过二进制日支传导从库服务器中, 然后再从库上对这些日志重新执行 (也叫重做) , 从而使得从库和主库的数据保持同步 .</p>
<p>MySQL支持一台主库同时向多台从库进行复制 , 从库同时也可以作为其他从服务器的主库 , 实现链状复制 .</p>
<p>MySQL复制的优点主要包含以下三个方面</p>
<ol>
<li>主库出现问题 , 可以快速切换到从库提供服务 .</li>
<li>实现读写分离 , 降低主库的访问压力</li>
<li>可以在从库中执行备份 , 以避免备份期间影响主库服务</li>
</ol>
<hr>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>MySQL的主从复制原理如下 :</p>
<ol>
<li>Master 主库在事务提交时 , 会把数据变更记录在二进制日志文件 Binlog 中.</li>
<li>从库读取的主库的二进制日志文件 Binlog , 写入到从库的中继日志Relay Log </li>
<li>slave重做中继日志中的时间 , 将改变反应他自己的数据 .</li>
</ol>
<hr>
<h3 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h3><ul>
<li><p>服务器准备</p>
<p>准备至少两台服务器</p>
<p>开放指定的3306端口号</p>
<blockquote>
<p>firewall-cmd —zone=public —add-port=3306/tcp -permanent</p>
<p>firewall-cmd —cme -reload</p>
</blockquote>
<p>关闭服务器中的防火墙</p>
<blockquote>
<p>systemctl stop firewalld</p>
<p>systemctl disable firewalld</p>
</blockquote>
<p>准备好服务器之后 , 在上述的服务器中分别安装好MySQL , 并完成基础的初始化准备工作 .</p>
</li>
<li><p>主库配置</p>
<ol>
<li><p>修改配置文件 /etc/my.cnf</p>
<blockquote>
<h1 id="mysql-服务ID，保证整个集群环境中唯一，取值范围-1-2-32-1，默认为1-server-id-1"><a href="#mysql-服务ID，保证整个集群环境中唯一，取值范围-1-2-32-1，默认为1-server-id-1" class="headerlink" title="mysql 服务ID，保证整个集群环境中唯一，取值范围: 1 - 2^32-1，默认为1                                                                     server-id=1"></a>mysql 服务ID，保证整个集群环境中唯一，取值范围: 1 - 2^32-1，默认为1                                                                     server-id=1</h1><h1 id="是否只读-1-代表只读-0-代表读写"><a href="#是否只读-1-代表只读-0-代表读写" class="headerlink" title="是否只读,1 代表只读,0 代表读写"></a>是否只读,1 代表只读,0 代表读写</h1><p>read-only=0</p>
<h1 id="忽略的数据-指不需要同步的数据库"><a href="#忽略的数据-指不需要同步的数据库" class="headerlink" title="忽略的数据,指不需要同步的数据库"></a>忽略的数据,指不需要同步的数据库</h1><h1 id="binlog-ignore-db-mysal"><a href="#binlog-ignore-db-mysal" class="headerlink" title="binlog-ignore-db=mysal"></a>binlog-ignore-db=mysal</h1><h1 id="指定同步的数据库"><a href="#指定同步的数据库" class="headerlink" title="指定同步的数据库"></a>指定同步的数据库</h1><h1 id="binlog-do-db-db01"><a href="#binlog-do-db-db01" class="headerlink" title="binlog-do-db=db01"></a>binlog-do-db=db01</h1></blockquote>
</li>
<li><p>重启MySQL服务器</p>
<blockquote>
<p>systemctl restart mysqld</p>
</blockquote>
</li>
<li><p>登录MySQL  , 创建远程连接的帐号 , 并授予主从复制权限</p>
<blockquote>
<h1 id="创建itcast用户，并设置密码，该用户可在任意主机连接该MySQL服务-CREATE-USER-‘itcast’-’-’-IDENTIFIED-WITH-mysal-native-password-BY-‘Root-123456’"><a href="#创建itcast用户，并设置密码，该用户可在任意主机连接该MySQL服务-CREATE-USER-‘itcast’-’-’-IDENTIFIED-WITH-mysal-native-password-BY-‘Root-123456’" class="headerlink" title="创建itcast用户，并设置密码，该用户可在任意主机连接该MySQL服务                                                                                 CREATE USER ‘itcast’@’%’ IDENTIFIED WITH mysal native password BY ‘Root@123456’ ;"></a>创建itcast用户，并设置密码，该用户可在任意主机连接该MySQL服务                                                                                 CREATE USER ‘itcast’@’%’ IDENTIFIED WITH mysal native password BY ‘Root@123456’ ;</h1><h1 id="为”itcast-’-’用户分配主从复制权限"><a href="#为”itcast-’-’用户分配主从复制权限" class="headerlink" title="为”itcast @’%’用户分配主从复制权限"></a>为”itcast @’%’用户分配主从复制权限</h1><p>GRANT REPLICATION SLAVE ON ** TO itcast @’%’ ;</p>
</blockquote>
</li>
<li><p>通过指令 , 查看二进制日志坐标</p>
<blockquote>
<p>show master status ;</p>
</blockquote>
</li>
</ol>
<p>字段含义说明 : </p>
<blockquote>
<p>file:         从哪个日志文件开始推送日志文件</p>
<p>position: 从哪个位置开始推送日志</p>
<p>binlog_ignore_db : 指定不需要同步的数据库</p>
</blockquote>
</li>
<li><p>从库配置</p>
<ol>
<li><p>修改配置文件 /etc/my.cnf</p>
<blockquote>
<h1 id="mysql-服务ID，保证整个集群环境中唯一，取值范围-1-2-32-1-和主库不一样即可-server-id-1"><a href="#mysql-服务ID，保证整个集群环境中唯一，取值范围-1-2-32-1-和主库不一样即可-server-id-1" class="headerlink" title="mysql 服务ID，保证整个集群环境中唯一，取值范围: 1 - 2^32-1, 和主库不一样即可                                                                  server-id=1"></a>mysql 服务ID，保证整个集群环境中唯一，取值范围: 1 - 2^32-1, 和主库不一样即可                                                                  server-id=1</h1><h1 id="是否只读-1-代表只读-0-代表读写-1"><a href="#是否只读-1-代表只读-0-代表读写-1" class="headerlink" title="是否只读,1 代表只读,0 代表读写"></a>是否只读,1 代表只读,0 代表读写</h1><p>read-only=0</p>
</blockquote>
</li>
<li><p>重新启动MySQL服务</p>
<blockquote>
<p>systemctl restart mysqld</p>
</blockquote>
</li>
<li><p>登录MySQL , 设置主库配置</p>
<blockquote>
<p>CHANGE REPLICATION OURCE TO SOURCE_HOST-‘xxx.xxx’,SOURCE_USER=’xxx’, SOURCE_PASSWORD-‘xxx’, SOURCE_LOG_FLE-‘xxx’, SOURCE_LOG_POS=’xxx’;</p>
</blockquote>
<p>上述是8.0.23中的语法 . 如果mysql是8.0.23之前的版本 , 执行如下sql:</p>
<blockquote>
<p>CHANGE MASTER TO MASTER_HOST = ‘xxx.xxx.xxx.xxx’ , MASTER_USER=’xxx’ , MASERT_PASSWORD = ‘xxx’,MASTER_LOG_FILE=’xxx’,MASTER_LOG-POS=xxx;</p>
</blockquote>
<p>|     参数名      |        含义        |   8.0.23之前    |<br>| :——————-: | :————————: | :——————-: |<br>|   SOURCE_HOST   |     主库IP地址     |   MASTER_HOST   |<br>|   SOURCE_USER   |  连接主库的用户名  |   MASTER_USER   |<br>| SOURCE_PASSWORD |   连接主库的密码   | MASTER_PASSWORD |<br>| SOURCE_LOG_FILE |  binlog日志文件名  | MASTER_LOG_FILE |<br>| SOURCE_LOG_POS  | binlog日志文件位置 | MASTER_LOG_POS  |</p>
</li>
<li><p>开启同步操作</p>
<blockquote>
<p>start replica ;        #8.0.22之后</p>
<p>start slave ;          #8.0.22之前</p>
</blockquote>
</li>
<li><p>查看主从同步状态</p>
<blockquote>
<p>show replica staus ;            #8.022之后</p>
<p>show slave status ;             #8.0.22之前</p>
</blockquote>
</li>
</ol>
<ul>
<li><p>测试</p>
<ol>
<li><p>在主库上创建数据库 , 表 , 并插入数据</p>
<blockquote>
<p>create database db01 ;</p>
<p>use db01 ;</p>
<p>create table tb_user(</p>
<p>​                        id int(11) primary key not null auto_increment ,</p>
<p>​                        name varchar(50) not null ,</p>
<p>​                        sex varchar(1)</p>
<p>)engine = innodb default charset = utf8mb4 ;</p>
<p>insert into tb_user(id , name msex) values(null , ‘Tom’ , ‘1’) , (null , ‘Trigger’ , ‘0’) , (null , ‘Dawn’ , ‘1’);</p>
</blockquote>
</li>
<li><p>从库中查询数据 , 验证主从是否同步</p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="分库分表"><a href="#分库分表" class="headerlink" title="分库分表"></a>分库分表</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li><p>问题分析</p>
<p>随着互联网及移动互联网的发展 , 应用系统的数据量也是成指数式增长 , 若采用单数据库进行数据储存 , 存在以下性能瓶颈:</p>
<ol>
<li>IO瓶颈 : 热点数据太多 , 数据库缓存不足 , 产生大量磁盘IO , 效率较低 . 请求数据太多 , 带宽不够 , 网络IO瓶颈 .</li>
<li>CPU瓶颈 : 排序 , 分组 , 连接查询 , 聚合查询 , 聚合统计等 SQL 会耗费大量的CPU资源 , 请求数太多 , CPU出现瓶颈</li>
</ol>
<blockquote>
<p>分库分表的中心思想都是将数据分散储存 , 使得单一数据库 / 表的数据量变小来缓解单一数据库的性能问题 , 从而达到提升数据库性能的目的 .</p>
</blockquote>
</li>
<li><p>拆分策略</p>
</li>
</ul>
<ol>
<li><p>垂直拆分</p>
<ul>
<li><p>垂直分库 : 以表为依据 , 根据业务将不同表拆分到不同库中.</p>
<p>特点 :</p>
<ol>
<li>每个表的表结构都不一样</li>
<li>每个库的数据也不一样</li>
<li>所有库的并集是全量数据</li>
</ol>
</li>
<li><p>垂直分表 : 以字段为依据 , 根据字段属性将不同字段拆分到不同表中</p>
<p>特点 :</p>
<ol>
<li>每个表的结构都不一样</li>
<li>每个表的数据也不一样 , 一般通过一列 (主键 / 外键) 关联</li>
<li>所有的表的并集是全量数据</li>
</ol>
</li>
</ul>
</li>
<li><p>水平拆分</p>
<ul>
<li><p>水平分库 : 以字段为依据 , 按照一定策略 , 将一个库的数据拆分到多个库中</p>
<p>特点 :</p>
<ol>
<li>每个库的表结构都一样</li>
<li>每个库的数据都不一样</li>
<li>所有库的并集是全量数据</li>
</ol>
</li>
<li><p>水平分表 : 以字段为依据 , 按照一定策略 , 将一个表的数据拆分到多个表中</p>
<p>特点 :</p>
<ol>
<li>每个表的表结构都一样</li>
<li>每个表的数据都不一样</li>
<li>所有表的并集是全量数据</li>
</ol>
</li>
</ul>
</li>
</ol>
<ul>
<li>实现技术<ul>
<li>shardingJDBC : 基于AOP原理 , 在应用程序中对本地执行的SQL进行拦截 , 解析 , 改写 , 路由处理 . 需要自行编码配置实现 , 之支持java语言 , 性能较高 .</li>
<li>MyCat : 数据库分库分表中间件 , 不用调整代码即可实现分库分表 , 支持多种语言 , 性能不及前者</li>
</ul>
</li>
</ul>
<hr>
<h3 id="Mycat概述"><a href="#Mycat概述" class="headerlink" title="Mycat概述"></a>Mycat概述</h3><ul>
<li><p>介绍</p>
<p>MyCat是开源的 , 活跃的 , 基于Java语言编写的MuSQL数据库中间件 . 可以像使用mysql一样来使用mycat , 对于开发人员来说根本感觉不到mycat的存在 .</p>
</li>
<li><p>优势:</p>
<ol>
<li>性能可靠稳定</li>
<li>强大的技术团队</li>
<li>体系完善</li>
<li>社区活跃</li>
</ol>
</li>
<li><p>目录结构</p>
<p>bin : 存放可执行文件 , 用于启动停止mycat</p>
<p>conf : 存放mycat的配置文件</p>
<p>lib : 存放mycat的项目依赖包 (jar)</p>
<p>logs : 存放mycat的日志文件</p>
</li>
</ul>
<hr>
<h3 id="Mycat入门"><a href="#Mycat入门" class="headerlink" title="Mycat入门"></a>Mycat入门</h3><ul>
<li><p>需求</p>
<p>由于tb_order表中数据量很大 , 磁盘IO及容量都到达了瓶颈 , 现在需要对tb_order表进行数据分片 , 分为三个数据节点 , 每一个系欸但主机位于不同的服务器上 .</p>
</li>
<li><p>环境配置</p>
</li>
<li><p>分片配置</p>
</li>
<li><p>启动服务</p>
<p>切换到MyCat的安装目录 , 执行如下指令 , 启动MyCat :</p>
<blockquote>
<h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><p>bin/mycat start</p>
<h1 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h1><p>bin/mycat stop</p>
</blockquote>
</li>
<li><p>分片测试</p>
<p>通过如下指令 , 就可以连接并登录MyCat</p>
<blockquote>
<p>mysql -h 192.168.200.210 -p 8066 -uroot -p123456</p>
</blockquote>
</li>
</ul>
<hr>
<h3 id="Mycat配置"><a href="#Mycat配置" class="headerlink" title="Mycat配置"></a>Mycat配置</h3><ul>
<li><p>schema.xml</p>
<p>schema.xml 作为 MyCat中最重要的配置文件之一 , 涵盖了MyCat的略疾苦 , 逻辑表 , 分片规则 , 分片节点 及数据源的配置.</p>
<p>主要包含以下三组标签 :</p>
<ul>
<li><p>schema标签</p>
</li>
<li><p>datanode标签</p>
</li>
<li><p>datahost标签</p>
<blockquote>
<ul>
<li><p>schema标签</p>
<p>schema标签用于定义MyCat示例中的逻辑库 , 一个MyCat实例中 , 可以有多个逻辑库 , 可以通过schema标签来划分不同的逻辑库 . MyCat中的逻辑库的概念 , 等同于MySQL中database概念 , 需要操作某个逻辑库下的表时 , 也需要切换逻辑库(use xxx) .</p>
<blockquote>
<ul>
<li>核心属性<ol>
<li>name :指定自定义的逻辑库库名</li>
<li>checkSQLschema : 在SQL语句操作时制定了数据库名称 , 执行时是否自动去除 ; ture : 自动去除 , false : 不自动去除</li>
<li>sqlMaxLimit : 如果未指定limit进行查询 ,列表查询模式查询多少条记录</li>
</ol>
</li>
</ul>
</blockquote>
</li>
<li><p>schema标签(table)</p>
<p>table标签定义了MyCat中逻辑库 schema 下的逻辑表 , 所有需要拆分的表都需要在table标签中定义 . </p>
<blockquote>
<p>核心属性:</p>
<ul>
<li>name :定义逻辑表表名 , 在该逻辑库下唯一</li>
<li>dataNode :定义逻辑表所属的dataNode , 该属性需要与dataNode标签中name对应; 多个dataNode逗号分隔</li>
<li>rule : 分片规则的名字 , 分片规则名字是在rule.xml中定义的</li>
<li>primaryKey : 逻辑表对真是表的主键</li>
<li>type :逻辑表的类型 , 目前逻辑表只有全局表和普通表 , 如果未配置 , 就是普通表 ; 全局表 , 配置为global</li>
</ul>
</blockquote>
</li>
<li><p>dataNode标签</p>
<p>dataNode标签中定义了MyCat中的数据节点 ,也就是我们通常说的数据分片.一个dataNode标签就是一个独立的数据分片</p>
<blockquote>
<p>核心属性 :</p>
<ul>
<li>name :定义数据节点名称</li>
<li>dataHost : 数据库实力主机名称, 引用自dataHost标签中name属性</li>
<li>database: 定义分片所需数据库</li>
</ul>
</blockquote>
</li>
<li><p>dataHost标签</p>
<p>该标签在MyCat逻辑库中作为底层标签存在 , 直接定义了具体的数据库实例 , 读写分离 , 心跳语句</p>
<blockquote>
<p>核心属性 :</p>
<ul>
<li>name : 唯一标识 , 供上层标签使用</li>
<li>maxCon / minCon : 最大连接数 / 最小连接数</li>
<li>balance : 负载均衡策略 , 取值 0,1,2,3</li>
<li>writeType : 写操作分发方式 (0: 写操作转发到第一个writeHost , 第一个挂了 ,切换到第二个 ; 1: 写操作随机分发到配置的writeHost)</li>
<li>dbDriver : 数据库驱动 , 支持 native , jdbc      </li>
</ul>
</blockquote>
</li>
<li><p>rule.xml</p>
<p>rule.xml中定义所有拆分表的规则 , 在使用过程中可以灵活的使用分片算法 , 或者对同一个分片算法使用不同的参数 , 他让分片过程可配置化 . 主要包含两类标签 : tableRule , Function .</p>
</li>
<li><p>server.xml</p>
<p>server.xml配置文件包含了MyCat的系统配置信息 , 主要有两个重要的标签 : system , user </p>
<ul>
<li><p>system标签</p>
<p>对应的系统配置项及其含义 , 参考资料</p>
</li>
<li><p>user</p>
<p>用户以及用户所具备的权限信息</p>
</li>
</ul>
</li>
</ul>
</blockquote>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="Mycat分片"><a href="#Mycat分片" class="headerlink" title="Mycat分片"></a>Mycat分片</h3><ul>
<li><p>垂直拆分</p>
<ul>
<li><p>场景 : 在业务系统中 , 设计一下表结构 ,但是由于用户预订单每天都会产生大量的数据 , 单台服务器的数据存储及处理能力是有限的 , 可以对数据库表进行拆分 .</p>
</li>
<li><p>准备</p>
<p>四台服务器</p>
<p>分别在三台服务器中创建数据库</p>
</li>
<li><p>配置</p>
</li>
<li><p>测试</p>
<p>在mycat的命令行中 , 通过source指令导入表结构 , 以及对应的数据 , 查看数据分布情况</p>
</li>
<li><p>全局表配置</p>
<p>属于数据字典表 ,多个业务模块中可能会遇到 , 可以将其设置为全局表 , 利于业务操作</p>
</li>
</ul>
</li>
<li><p>水平拆分</p>
<ul>
<li><p>场景</p>
<p>在业务系统中 , 有一张表(日志表) 业务系统每天都会产生大量的日志数据 , 单体服务器的数据存储及处理能力是有限的 , 可以对数据库表进行拆分 .</p>
</li>
<li><p>准备</p>
<p>四台服务器</p>
<p>分别在三台服务器中创建数据库</p>
</li>
<li><p>配置</p>
</li>
<li><p>测试</p>
</li>
</ul>
</li>
<li><p>分片规则-范围</p>
<p>根据指定的字段及其配置的范围与数据节点的对应情况 , 来决定该数据属于哪一个分片 .</p>
</li>
<li><p>分片规则-取模</p>
<p>根据指定的字段之与节点数量进行求模运算 , 根据运算结果 , 来决定该数据属于哪一个分片 .</p>
</li>
<li><p>分片规则-一致性hash</p>
<p>所谓一致性哈希 , 相同的哈希因子计算值总是被划分到相同的分区表中 , 不会因为分区节点的增加而改变原来数据的分区位置 .</p>
</li>
<li><p>分片规则-枚举</p>
<p>通过在配置文件中配置可能的枚举值 , 指定数据分布到不同数据集欸但上 , 本规则适用于按照省分 , 性别 , 状态拆分数据等业务 .</p>
</li>
<li><p>分片规则-应用指定</p>
<p>运行阶段有应用自主界定路由到哪个分片 , 直接根据字符字串(必须是数字) 计算分片号 .</p>
</li>
<li><p>分片规则-固定分片hash算法</p>
<p>该算法类似于十进制的求模运算 , 但是为二进制的操作 , 例如 , 去id 的二进制低10 位与1111111111 进行位 &amp; 运算</p>
<blockquote>
<p>特点: </p>
<ul>
<li>如果是求模 , 连续的值 , 分别分配到各个不同的分片 ; 但是此算法会将连续的值可能分配到相同的分片 , 降低事务处理的难度</li>
<li>可以均匀分配 , 也可以非均匀分配 .</li>
<li>分片字段必须为数字类型 .</li>
</ul>
</blockquote>
</li>
<li><p>分片规则- 字符串hash解析</p>
<p>截取字符串中的指定位置的子字符串 ,进行hash算法 ,算出分片 .</p>
</li>
<li><p>分片规则-按 (天) 日期分片</p>
</li>
<li><p>分片规则-自然月</p>
<p>使用场景为按照月份来分片, 每个自然月为一个分片 .</p>
</li>
</ul>
<hr>
<h3 id="Mycat管理及监控"><a href="#Mycat管理及监控" class="headerlink" title="Mycat管理及监控"></a>Mycat管理及监控</h3><ul>
<li><p>MyCat原理</p>
<p>解析SQL -&gt; 分片分析 -&gt; 路由分析 -&gt; 读写分离分析 -&gt; … </p>
<p>… &lt;- 分页处理 &lt;- 排序处理 &lt;- 聚合处理 &lt;- 结果合并</p>
</li>
<li><p>MyCat管理</p>
<p>Mycat默认开通2个端口 , 可以在server.xml中进行修改 . </p>
<ul>
<li><p>8066 数据访问端口 , 即进行DML 和 DDL 操作 .</p>
</li>
<li><p>9066 数据库管理端口 , 即 mycat 服务管理控制功能 , 用于管理mycat的整个集群状态</p>
<blockquote>
<p>mysql -h 192.168.200.210 -p 9066 -uroot -p123456</p>
</blockquote>
</li>
</ul>
<p>|       命令        |            含义             |<br>| :———————-: | :————————————-: |<br>|    show @@help    |  查看mycat管理工具帮助文档  |<br>|  show @@version   |       查看mycat的版本       |<br>|  reload @@config  |   重新加载mycat的配置文件   |<br>| show @@datasource |    查看mycat的数据源信息    |<br>|  show @@datanode  | 查看mycat现有的分片节点信息 |<br>| show @@threadpool |    查看mycat的线程池信息    |<br>|    show @@sql     |        查看执行的sql        |<br>|  show @@sql.sum   |      查看执行的sql统计      |</p>
</li>
<li><p>mycat - eye</p>
<ul>
<li>介绍</li>
<li>mycat-web (mycat-eye) 是对mycat-server提供监控服务 , 功能不局限于对 mycat-server使用 . 它通过JDBC连接对mycat , mysql监控 , 监控远程服务器(目前仅限于linux系统)的</li>
</ul>
<p>黑马程序员MySQL第185集</p>
</li>
</ul>
<hr>
<hr>
<h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">MYC</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/05/11/MySQL/">http://example.com/2024/05/11/MySQL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">MYC</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechatpay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/wechatpay.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/04/21/%E5%9F%BA%E4%BA%8E%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E9%AD%94%E6%94%B9%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A1-%E6%8F%90%E7%93%A6%E7%89%B9%E5%A4%96%E5%8D%96/" title="基于瑞吉外卖魔改的数据库课程设计--提瓦特外卖"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/tivat.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">基于瑞吉外卖魔改的数据库课程设计--提瓦特外卖</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="comment-switch"><span class="first-comment">Valine</span><span id="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/xiaoxin.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">MYC</div><div class="author-info__description">桀桀桀</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">MySQL基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DDL-DML-DQL-DCL"><span class="toc-number">1.1.</span> <span class="toc-text">DDL,DML,DQL,DCL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">SQL分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DDL"><span class="toc-number">1.2.1.</span> <span class="toc-text">DDL:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DDL-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">DDL-基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.1.1.1.</span> <span class="toc-text">查询 :</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">1.2.1.1.2.</span> <span class="toc-text">创建 :</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">1.2.1.1.3.</span> <span class="toc-text">删除 :</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.1.1.4.</span> <span class="toc-text">使用 :</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DDL-%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">DDL-表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2-1"><span class="toc-number">1.2.1.2.1.</span> <span class="toc-text">查询 :</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-1"><span class="toc-number">1.2.1.2.2.</span> <span class="toc-text">创建:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-number">1.2.1.2.3.</span> <span class="toc-text">修改:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-1"><span class="toc-number">1.2.1.2.4.</span> <span class="toc-text">删除:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.1.2.5.</span> <span class="toc-text">数据类型:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DML"><span class="toc-number">1.2.2.</span> <span class="toc-text">DML:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">添加数据:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">修改数据:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">删除数据:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DQL"><span class="toc-number">1.2.3.</span> <span class="toc-text">DQL:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2-2"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.3.1.1.</span> <span class="toc-text">基本查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.3.1.2.</span> <span class="toc-text">条件查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.3.1.3.</span> <span class="toc-text">分组查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.3.1.4.</span> <span class="toc-text">排序查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.3.1.5.</span> <span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.3.1.6.</span> <span class="toc-text">聚合函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.2.3.1.7.</span> <span class="toc-text">编写顺序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.2.3.1.8.</span> <span class="toc-text">执行顺序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DCL"><span class="toc-number">1.2.4.</span> <span class="toc-text">DCL:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">管理用户</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7"><span class="toc-number">1.2.4.1.1.</span> <span class="toc-text">查询用户</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-number">1.2.4.1.2.</span> <span class="toc-text">创建用户</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-number">1.2.4.1.3.</span> <span class="toc-text">修改用户密码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="toc-number">1.2.4.1.4.</span> <span class="toc-text">删除用户</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">权限控制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%9D%83%E9%99%90"><span class="toc-number">1.2.4.2.1.</span> <span class="toc-text">查询权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%88%E4%BA%88%E6%9D%83%E9%99%90"><span class="toc-number">1.2.4.2.2.</span> <span class="toc-text">授予权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%92%A4%E9%94%80%E6%9D%83%E9%99%90"><span class="toc-number">1.2.4.2.3.</span> <span class="toc-text">撤销权限</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">字符串函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.2.</span> <span class="toc-text">数值函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.3.</span> <span class="toc-text">日期函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.4.</span> <span class="toc-text">流程函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.4.</span> <span class="toc-text">约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.4.1.</span> <span class="toc-text">常见约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.4.2.</span> <span class="toc-text">外键约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.</span> <span class="toc-text">多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="toc-number">1.5.1.</span> <span class="toc-text">多表关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E6%A6%82%E8%BF%B0"><span class="toc-number">1.5.2.</span> <span class="toc-text">多表查询概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.5.3.</span> <span class="toc-text">内连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.5.4.</span> <span class="toc-text">外连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.5.5.</span> <span class="toc-text">自连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.6.</span> <span class="toc-text">联合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.7.</span> <span class="toc-text">子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%87%E9%87%8F%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.7.1.</span> <span class="toc-text">标量子查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.6.</span> <span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%AE%80%E4%BB%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">事务的简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.2.</span> <span class="toc-text">事务操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="toc-number">1.6.3.</span> <span class="toc-text">事务的四大特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="toc-number">1.6.4.</span> <span class="toc-text">并发事务问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.5.</span> <span class="toc-text">事务的隔离级别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E8%BF%9B%E9%98%B6"><span class="toc-number">2.</span> <span class="toc-text">MySQL进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">2.1.</span> <span class="toc-text">存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.1.</span> <span class="toc-text">MySQL体系结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.2.</span> <span class="toc-text">存储引擎简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%89%B9%E7%82%B9"><span class="toc-number">2.1.3.</span> <span class="toc-text">存储引擎特点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#InnoDB"><span class="toc-number">2.1.3.1.</span> <span class="toc-text">InnoDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyISAM"><span class="toc-number">2.1.3.2.</span> <span class="toc-text">MyISAM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Memory"><span class="toc-number">2.1.3.3.</span> <span class="toc-text">Memory</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E9%80%89%E6%8B%A9"><span class="toc-number">2.1.4.</span> <span class="toc-text">存储引擎选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">2.2.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%A6%82%E8%BF%B0"><span class="toc-number">2.2.1.</span> <span class="toc-text">索引概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.2.</span> <span class="toc-text">索引结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB"><span class="toc-number">2.2.3.</span> <span class="toc-text">索引分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AF%AD%E6%B3%95"><span class="toc-number">2.2.4.</span> <span class="toc-text">索引语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">2.2.5.</span> <span class="toc-text">SQL性能分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%90%AFMySQL%E6%85%A2%E6%97%A5%E5%BF%97%E6%9F%A5%E8%AF%A2%E5%BC%80%E5%85%B3"><span class="toc-number">3.</span> <span class="toc-text">开启MySQL慢日志查询开关</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%85%A2%E6%97%A5%E5%BF%97%E7%9A%84%E6%97%B6%E9%97%B4%E4%B8%BA2%E7%A7%92-SQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E8%B6%85%E8%BF%872%E7%A7%92-%E5%B0%B1%E4%BC%9A%E8%A7%86%E4%B8%BA%E6%85%A2%E6%9F%A5%E8%AF%A2-%E8%AE%B0%E5%BD%95%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">4.</span> <span class="toc-text">设置慢日志的时间为2秒 ,SQL语句执行时间超过2秒 , 就会视为慢查询 , 记录慢查询日志</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%AF%8F%E4%B8%80%E6%9D%A1SQL%E7%9A%84%E5%A5%BD%E4%BA%8B%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5"><span class="toc-number">5.</span> <span class="toc-text">查看每一条SQL的好事基本情况</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9Aquery-id%E7%9A%84SQL%E8%AF%AD%E5%8F%A5%E5%90%84%E4%B8%AA%E9%98%B6%E6%AE%B5%E7%9A%84%E8%80%97%E6%97%B6%E6%83%85%E5%86%B5"><span class="toc-number">6.</span> <span class="toc-text">查看指定query_id的SQL语句各个阶段的耗时情况</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9Aquery-id%E7%9A%84SQL%E8%AF%AD%E5%8F%A5CPU%E7%9A%84%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5"><span class="toc-number">7.</span> <span class="toc-text">查看指定query_id的SQL语句CPU的使用情况</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%9C%A8select%E8%AF%AD%E5%8F%A5%E4%B9%8B%E5%89%8D%E5%8A%A0%E4%B8%8A%E5%85%B3%E9%94%AE%E5%AD%97-explain-desc"><span class="toc-number">8.</span> <span class="toc-text">直接在select语句之前加上关键字 explain &#x2F; desc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8"><span class="toc-number">8.0.1.</span> <span class="toc-text">索引使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">8.0.2.</span> <span class="toc-text">索引设计原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E4%BC%98%E5%8C%96"><span class="toc-number">8.1.</span> <span class="toc-text">SQL优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">8.1.1.</span> <span class="toc-text">插入数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%97%B6-%E5%8A%A0%E4%B8%8A%E5%8F%82%E6%95%B0-%E2%80%94local-infile"><span class="toc-number">9.</span> <span class="toc-text">客户端连接服务端时 , 加上参数 —local-infile</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%85%A8%E5%B1%80%E5%8F%82%E6%95%B0local-infile%E4%B8%BA1-%E5%BC%80%E5%90%AF%E4%BB%8E%E6%9C%AC%E5%9C%B0%E5%8A%A0%E8%BD%BD%E6%96%87%E4%BB%B6%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E7%9A%84%E5%BC%80%E5%85%B3"><span class="toc-number">10.</span> <span class="toc-text">设置全局参数local_infile为1 , 开启从本地加载文件导入数据的开关</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%A7%E8%A1%8Cload%E6%8C%87%E4%BB%A4%E5%B0%86%E5%87%86%E5%A4%87%E5%A5%BD%E7%9A%84%E6%95%B0%E6%8D%AE-%E5%8A%A0%E8%BD%BD%E5%88%B0%E8%A1%A8%E7%BB%93%E6%9E%84%E4%B8%AD"><span class="toc-number">11.</span> <span class="toc-text">执行load指令将准备好的数据 , 加载到表结构中</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E4%BC%98%E5%8C%96"><span class="toc-number">11.0.1.</span> <span class="toc-text">主键优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#order-by%E4%BC%98%E5%8C%96"><span class="toc-number">11.0.2.</span> <span class="toc-text">order by优化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E6%97%B6-%E6%A0%B9%E6%8D%AEage-phone-%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F"><span class="toc-number">12.</span> <span class="toc-text">没有创建索引时 , 根据age , phone 进行排序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">13.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E5%90%8E-%E6%A0%B9%E6%8D%AEage-phone%E8%BF%9B%E8%A1%8C%E5%8D%87%E5%BA%8F%E6%8E%92%E5%BA%8F"><span class="toc-number">14.</span> <span class="toc-text">创建索引后 , 根据age , phone进行升序排序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E5%90%8E-%E6%A0%B9%E6%8D%AEage-phone%E8%BF%9B%E8%A1%8C%E9%99%8D%E5%BA%8F%E6%8E%92%E5%BA%8F"><span class="toc-number">15.</span> <span class="toc-text">创建索引后 , 根据age , phone进行降序排序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEage-phone%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F-%E4%B8%80%E4%B8%AA%E5%8D%87%E5%BA%8F-%E4%B8%80%E4%B8%AA%E9%99%8D%E5%BA%8F"><span class="toc-number">16.</span> <span class="toc-text">根据age , phone进行排序 , 一个升序 , 一个降序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95-1"><span class="toc-number">17.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEage-phone-%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F-%E4%B8%80%E4%B8%AA%E5%8D%87%E5%BA%8F-%E4%B8%80%E4%B8%AA%E9%99%8D%E5%BA%8F"><span class="toc-number">18.</span> <span class="toc-text">根据age ,phone 进行排序 一个升序 , 一个降序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#group-by%E4%BC%98%E5%8C%96"><span class="toc-number">18.0.1.</span> <span class="toc-text">group by优化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%8E%89%E7%9B%AE%E5%89%8D%E7%9A%84%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95idx-user-pro-age-sta"><span class="toc-number">19.</span> <span class="toc-text">删除掉目前的联合索引idx user _pro age sta</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%88%86%E7%BB%84%E6%93%8D%E4%BD%9C%EF%BC%8C%E6%A0%B9%E6%8D%AEprofession%E5%AD%97%E6%AE%B5%E5%88%86%E7%BB%84"><span class="toc-number">20.</span> <span class="toc-text">执行分组操作，根据profession字段分组</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95-2"><span class="toc-number">21.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%88%86%E7%BB%84%E6%93%8D%E4%BD%9C%EF%BC%8C%E6%A0%B9%E6%8D%AEprofession%E5%AD%97%E6%AE%B5%E5%88%86%E7%BB%84-1"><span class="toc-number">22.</span> <span class="toc-text">执行分组操作，根据profession字段分组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#limit%E4%BC%98%E5%8C%96"><span class="toc-number">22.0.1.</span> <span class="toc-text">limit优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#count%E4%BC%98%E5%8C%96"><span class="toc-number">22.0.2.</span> <span class="toc-text">count优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update%E4%BC%98%E5%8C%96"><span class="toc-number">22.0.3.</span> <span class="toc-text">update优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">22.1.</span> <span class="toc-text">视图 &#x2F; 存储过程 &#x2F; 触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">22.1.1.</span> <span class="toc-text">视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">22.1.2.</span> <span class="toc-text">存储过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%88%E5%88%A4%E5%AE%9A%E6%9D%A1%E4%BB%B6-%E5%A6%82%E6%9E%9C%E6%9D%A1%E4%BB%B6%E4%B8%BAtrue-%E5%88%99%E6%89%A7%E8%A1%8C%E9%80%BB%E8%BE%91-%E5%90%A6%E5%88%99-%E4%B8%8D%E6%89%A7%E8%A1%8C%E9%80%BB%E8%BE%91"><span class="toc-number">23.</span> <span class="toc-text">先判定条件  , 如果条件为true , 则执行逻辑 , 否则 , 不执行逻辑</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%88%E6%89%A7%E8%A1%8C%E4%B8%80%E6%AC%A1%E9%80%BB%E8%BE%91-%E7%84%B6%E5%90%8E%E5%88%A4%E5%AE%9A%E9%80%BB%E8%BE%91%E6%98%AF%E5%90%A6%E6%BB%A1%E8%B6%B3-%E5%A6%82%E6%9E%9C%E6%BB%A1%E8%B6%B3-%E5%88%99%E9%80%80%E5%87%BA-%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%BB%A1%E8%B6%B3-%E5%88%99%E7%BB%A7%E7%BB%AD%E4%B8%8B%E4%B8%80%E6%AC%A1%E5%BE%AA%E7%8E%AF"><span class="toc-number">24.</span> <span class="toc-text">先执行一次逻辑 , 然后判定逻辑是否满足 , 如果满足 , 则退出 , 如果不满足 , 则继续下一次循环</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">24.0.1.</span> <span class="toc-text">存储函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">24.0.2.</span> <span class="toc-text">触发器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%81"><span class="toc-number">24.1.</span> <span class="toc-text">锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">24.1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E9%94%81"><span class="toc-number">24.1.2.</span> <span class="toc-text">全局锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="toc-number">24.1.3.</span> <span class="toc-text">表级锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="toc-number">24.1.4.</span> <span class="toc-text">行级锁</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">25.</span> <span class="toc-text">注意</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB%E5%BC%95%E6%93%8E"><span class="toc-number">25.1.</span> <span class="toc-text">InnoDB引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">25.1.1.</span> <span class="toc-text">逻辑存储结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-number">25.1.2.</span> <span class="toc-text">架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86"><span class="toc-number">25.1.3.</span> <span class="toc-text">事务原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MVCC"><span class="toc-number">25.1.4.</span> <span class="toc-text">MVCC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E7%AE%A1%E7%90%86"><span class="toc-number">25.2.</span> <span class="toc-text">MySQL管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">25.2.1.</span> <span class="toc-text">系统数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">25.2.2.</span> <span class="toc-text">常用工具</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E8%BF%90%E7%BB%B4"><span class="toc-number">26.</span> <span class="toc-text">MySQL运维</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-number">26.1.</span> <span class="toc-text">日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="toc-number">26.1.1.</span> <span class="toc-text">错误日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97"><span class="toc-number">26.1.2.</span> <span class="toc-text">二进制日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">26.1.3.</span> <span class="toc-text">查询日志</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%A5%E9%80%89%E9%A1%B9%E7%94%A8%E6%9D%A5%E5%BC%80%E5%90%AF%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97-%EF%BC%8C-%E5%8F%AF%E9%80%89%E5%80%BC-0-%E6%88%96%E8%80%851-0-%E4%BB%A3%E8%A1%A8%E5%85%B3%E9%97%AD%EF%BC%8C-1%E4%BB%A3%E8%A1%A8%E5%BC%80%E5%90%AF-general-log-1"><span class="toc-number">27.</span> <span class="toc-text">该选项用来开启查询日志 ， 可选值 : 0 或者1;0 代表关闭， 1代表开启                                                                                  general_log&#x3D;1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%97%A5%E5%BF%97%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%EF%BC%8C%E9%BB%98%E8%AE%A4%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D%E4%B8%BA-host-name-log-general-log-file-mysql-query-log"><span class="toc-number">28.</span> <span class="toc-text">设置日志的文件名，如果没有指定，默认的文件名为 host name.log                                                           general_log_file&#x3D;mysql_query.log</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">28.0.1.</span> <span class="toc-text">慢查询日志</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97-slow-query-log-1"><span class="toc-number">29.</span> <span class="toc-text">慢查询日志                                                                                                                                                                      slow_query_log&#x3D;1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E5%8F%82%E6%95%B0-long-query-time-2"><span class="toc-number">30.</span> <span class="toc-text">执行时间参数                                                                                                                                                           long_query_time&#x3D;2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E6%89%A7%E8%A1%8C%E8%BE%83%E6%85%A2%E7%9A%84%E7%AE%A1%E7%90%86%E8%AF%AD%E5%8F%A5"><span class="toc-number">31.</span> <span class="toc-text">记录执行较慢的管理语句</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E6%89%A7%E8%A1%8C%E8%BE%83%E6%85%A2%E7%9A%84%E6%9C%AA%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E7%9A%84%E8%AF%AD%E5%8F%A5"><span class="toc-number">32.</span> <span class="toc-text">记录执行较慢的未使用索引的语句</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">32.1.</span> <span class="toc-text">主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">32.1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">32.1.2.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA"><span class="toc-number">32.1.3.</span> <span class="toc-text">搭建</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql-%E6%9C%8D%E5%8A%A1ID%EF%BC%8C%E4%BF%9D%E8%AF%81%E6%95%B4%E4%B8%AA%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E4%B8%AD%E5%94%AF%E4%B8%80%EF%BC%8C%E5%8F%96%E5%80%BC%E8%8C%83%E5%9B%B4-1-2-32-1%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA1-server-id-1"><span class="toc-number">33.</span> <span class="toc-text">mysql 服务ID，保证整个集群环境中唯一，取值范围: 1 - 2^32-1，默认为1                                                                     server-id&#x3D;1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%98%AF%E5%90%A6%E5%8F%AA%E8%AF%BB-1-%E4%BB%A3%E8%A1%A8%E5%8F%AA%E8%AF%BB-0-%E4%BB%A3%E8%A1%A8%E8%AF%BB%E5%86%99"><span class="toc-number">34.</span> <span class="toc-text">是否只读,1 代表只读,0 代表读写</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BF%BD%E7%95%A5%E7%9A%84%E6%95%B0%E6%8D%AE-%E6%8C%87%E4%B8%8D%E9%9C%80%E8%A6%81%E5%90%8C%E6%AD%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">35.</span> <span class="toc-text">忽略的数据,指不需要同步的数据库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#binlog-ignore-db-mysal"><span class="toc-number">36.</span> <span class="toc-text">binlog-ignore-db&#x3D;mysal</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%90%8C%E6%AD%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">37.</span> <span class="toc-text">指定同步的数据库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#binlog-do-db-db01"><span class="toc-number">38.</span> <span class="toc-text">binlog-do-db&#x3D;db01</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAitcast%E7%94%A8%E6%88%B7%EF%BC%8C%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81%EF%BC%8C%E8%AF%A5%E7%94%A8%E6%88%B7%E5%8F%AF%E5%9C%A8%E4%BB%BB%E6%84%8F%E4%B8%BB%E6%9C%BA%E8%BF%9E%E6%8E%A5%E8%AF%A5MySQL%E6%9C%8D%E5%8A%A1-CREATE-USER-%E2%80%98itcast%E2%80%99-%E2%80%99-%E2%80%99-IDENTIFIED-WITH-mysal-native-password-BY-%E2%80%98Root-123456%E2%80%99"><span class="toc-number">39.</span> <span class="toc-text">创建itcast用户，并设置密码，该用户可在任意主机连接该MySQL服务                                                                                 CREATE USER ‘itcast’@’%’ IDENTIFIED WITH mysal native password BY ‘Root@123456’ ;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BA%E2%80%9Ditcast-%E2%80%99-%E2%80%99%E7%94%A8%E6%88%B7%E5%88%86%E9%85%8D%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%9D%83%E9%99%90"><span class="toc-number">40.</span> <span class="toc-text">为”itcast @’%’用户分配主从复制权限</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql-%E6%9C%8D%E5%8A%A1ID%EF%BC%8C%E4%BF%9D%E8%AF%81%E6%95%B4%E4%B8%AA%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E4%B8%AD%E5%94%AF%E4%B8%80%EF%BC%8C%E5%8F%96%E5%80%BC%E8%8C%83%E5%9B%B4-1-2-32-1-%E5%92%8C%E4%B8%BB%E5%BA%93%E4%B8%8D%E4%B8%80%E6%A0%B7%E5%8D%B3%E5%8F%AF-server-id-1"><span class="toc-number">41.</span> <span class="toc-text">mysql 服务ID，保证整个集群环境中唯一，取值范围: 1 - 2^32-1, 和主库不一样即可                                                                  server-id&#x3D;1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%98%AF%E5%90%A6%E5%8F%AA%E8%AF%BB-1-%E4%BB%A3%E8%A1%A8%E5%8F%AA%E8%AF%BB-0-%E4%BB%A3%E8%A1%A8%E8%AF%BB%E5%86%99-1"><span class="toc-number">42.</span> <span class="toc-text">是否只读,1 代表只读,0 代表读写</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="toc-number">42.1.</span> <span class="toc-text">分库分表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">42.1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mycat%E6%A6%82%E8%BF%B0"><span class="toc-number">42.1.2.</span> <span class="toc-text">Mycat概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mycat%E5%85%A5%E9%97%A8"><span class="toc-number">42.1.3.</span> <span class="toc-text">Mycat入门</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8"><span class="toc-number">43.</span> <span class="toc-text">启动</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2"><span class="toc-number">44.</span> <span class="toc-text">停止</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mycat%E9%85%8D%E7%BD%AE"><span class="toc-number">44.0.1.</span> <span class="toc-text">Mycat配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mycat%E5%88%86%E7%89%87"><span class="toc-number">44.0.2.</span> <span class="toc-text">Mycat分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mycat%E7%AE%A1%E7%90%86%E5%8F%8A%E7%9B%91%E6%8E%A7"><span class="toc-number">44.0.3.</span> <span class="toc-text">Mycat管理及监控</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">44.1.</span> <span class="toc-text">读写分离</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/05/11/MySQL/" title="MySQL"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL"/></a><div class="content"><a class="title" href="/2024/05/11/MySQL/" title="MySQL">MySQL</a><time datetime="2024-05-11T00:42:00.000Z" title="发表于 2024-05-11 08:42:00">2024-05-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/21/%E5%9F%BA%E4%BA%8E%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E9%AD%94%E6%94%B9%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A1-%E6%8F%90%E7%93%A6%E7%89%B9%E5%A4%96%E5%8D%96/" title="基于瑞吉外卖魔改的数据库课程设计--提瓦特外卖"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/tivat.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于瑞吉外卖魔改的数据库课程设计--提瓦特外卖"/></a><div class="content"><a class="title" href="/2024/04/21/%E5%9F%BA%E4%BA%8E%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E9%AD%94%E6%94%B9%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A1-%E6%8F%90%E7%93%A6%E7%89%B9%E5%A4%96%E5%8D%96/" title="基于瑞吉外卖魔改的数据库课程设计--提瓦特外卖">基于瑞吉外卖魔改的数据库课程设计--提瓦特外卖</a><time datetime="2024-04-21T07:08:27.000Z" title="发表于 2024-04-21 15:08:27">2024-04-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/18/Typora%E6%95%99%E7%A8%8B/" title="博客写作的必会技能--markdown"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/markdown.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="博客写作的必会技能--markdown"/></a><div class="content"><a class="title" href="/2024/04/18/Typora%E6%95%99%E7%A8%8B/" title="博客写作的必会技能--markdown">博客写作的必会技能--markdown</a><time datetime="2024-04-18T03:49:32.000Z" title="发表于 2024-04-18 11:49:32">2024-04-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2003 - 2024 By MYC</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">欢迎来到我的博客</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"></svg><use id="modeicon" xlink:href="#icon-moon"></use></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const abcjsInit = () => {
    const abcjsFn = () => {
      document.querySelectorAll(".abc-music-sheet").forEach(ele => {
        ABCJS.renderAbc(ele, ele.innerHTML, {responsive: 'resize'})
      })
    }
    
    typeof ABCJS === 'object' ? abcjsFn()
      : getScript('https://cdn.jsdelivr.net/npm/abcjs@6.3.0/dist/abcjs-basic-min.min.js').then(abcjsFn)
  }

  window.pjax ? abcjsInit() : window.addEventListener('load', abcjsInit)
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><script>(() => {
  const disqus_config = function () {
    this.page.url = 'http://example.com/2024/05/11/MySQL/'
    this.page.identifier = '/2024/05/11/MySQL/'
    this.page.title = 'MySQL'
  }

  const disqusReset = () => {
    window.DISQUS && window.DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addGlobalFn('themeChange', disqusReset, 'disqus')

  const loadDisqus = () =>{
    if (window.DISQUS) disqusReset()
    else {
      const script = document.createElement('script')
      script.src = 'https://.disqus.com/embed.js'
      script.setAttribute('data-timestamp', +new Date())
      document.head.appendChild(script)
    }
  }

  const getCount = async() => {
    try {
      const eleGroup = document.querySelector('#post-meta .disqus-comment-count')
      if (!eleGroup) return
      const cleanedLinks = eleGroup.href.replace(/#post-comment$/, '')

      const res = await fetch(`https://disqus.com/api/3.0/threads/set.json?forum=&api_key=&thread:link=${cleanedLinks}`,{
        method: 'GET'
      })
      const result = await res.json()

      const count = result.response.length ? result.response[0].posts : 0
      eleGroup.textContent = count
    } catch (err) {
      console.error(err)
    }
  }

  if ('Valine' === 'Disqus' || !false) {
    if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
    else {
      loadDisqus()
      GLOBAL_CONFIG_SITE.isPost && getCount()
    }
  } else {
    window.loadOtherComment = loadDisqus
  }
})()</script></div><div class="aplayer no-destroy" data-id="2791573169" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><canvas id="universe"></canvas><script src="/js/universe.js"></script><script src="/js/sun_moon.js" async></script><script async src="/js/title.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,爱国,敬业,诚信,友善,自由,平等,公正,法制" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>